---
title: "Workflow diagrams"
format: 
  html:
    page-layout: full
toc: true #table of contents
number-sections: true
---

## Final MS-ready version? (Jan)
```{mermaid}
%%| fig-label: fig-1
%%| fig-width: 9
%%| fig-cap: "Figure 1: Diagram of workflow used for analysing movement data (thick line denotes core path of workflow)"
%%{init:{'flowchart':{'nodeSpacing': 5, 'rankSpacing': 30}}}%%
flowchart LR
subgraph ALL [" "]
style ALL fill:none,stroke:none
  S1[Read in data] ==> S3{Merge}
  S2[Read in metadata] ==> S3 ==> A(Process) ==> B(Filter) ==> C(Save) 
  A --> A1((Shiny app)) --> B
  B --->|"<br/> Summarise/<br/>Visualise"|C
  B --> B1((Shiny app)) --> C
  end
  C --> D
  C --> C1((Shiny app))
  C ==> S{Analyses}
  subgraph OPTIONAL ["OPTIONAL"]
    style OPTIONAL fill:#fbfbfb, stroke:#999, stroke-width:px, stroke-dasharray:5 5
    D(Post-process) --> E(Save)
    C1 --> D
    D --->|"<br/> Summarise/<br/>Visualise"|E
    end
    E --> S
    linkStyle 0,1,2,3,4,12 stroke-width:5px %% stroke:#00dca5 (this bit is how you edit colours of lines â€” no way to change colour of arrow heads)
%% NOTE: remember to update links for finalised user guide!!
```


## Main simple Jan 2023
```{mermaid}
%%| fig-width: 9
%%| fig-cap: "Figure 1: Diagram of workflow used for analysing movement data"
%%{init:{'flowchart':{'nodeSpacing': 5, 'rankSpacing': 30}}}%%
flowchart LR
subgraph ALL [" "]
style ALL fill:none,stroke:none
  A(Processing) ==> B(Filter) ==> C(Save) 
  A --> A1((Shiny app)) --> B
  B --->|"<br/> Summarise/<br/>Visualise"|C
  B --> B1((Shiny app)) --> C
  end
  C --> D
  C --> C1((Shiny app))
  C ==> S{Analyses}
  subgraph OPTIONAL ["OPTIONAL"]
    style OPTIONAL fill:#fbfbfb, stroke:#999, stroke-width:px, stroke-dasharray:5 5
    D(Post-processing) --> E(Save)
    C1 --> D
    D --->|"<br/> Summarise/<br/>Visualise"|E
    end
    E --> S
%% NOTE: remember to update links for finalised user guide!!
```

## Main simple Oct 2022

```{mermaid}
%%| fig-width: 9
%%{init:{'flowchart':{'nodeSpacing': 70, 'rankSpacing': 30}}}%%
flowchart LR
  A[Read in data] --> C{Merge}
  B[Read in metadata] --> C
  C --> D(Filter)
  D --> E(Process)
  E --> F(Save for Shiny)
  F --> X(("Shiny app<br/>(optional)")) --> G
  F --->|Skip app|G(Filter II)
  G --> H(Summarise)
  H --> I(Save/export)
  H --> J(Visualise)
    subgraph OPTIONAL ["post-processing (optional)"]
    style OPTIONAL fill:#E4E4E4,stroke:#999,stroke-width:px,stroke-dasharray: 5 5
        direction LR
        Z("- Resample data<br/>- Define segments<br/>- Define trips")
        style Z text-align:left
    end
 H --> OPTIONAL
  click A "#read-in-data-files";
  click B "#merge-with-metadata";
  click C "#merge-with-metadata";
  click D "#filtering-i";
  click E "#processing-i";
  click F "#save-for-shiny";
  click G "#filtering-ii";
  click H "#summarise-data";
  click I "#save-filtered-and-summary-data";
  click J "#visualisation-i";
```

## Main simple Aug 2022

```{mermaid}
%%| fig-width: 9
%%{init:{'flowchart':{'nodeSpacing': 120, 'rankSpacing': 40}}}%%
flowchart LR
  A[Read in data] --> C{Merge}
  B[Read in metadata] --> C
  C --> D(Filter I)
  D --> E(Process I)
  E --> F(Summarise)
  F --> G(Visualise)
  G -->|No post-processing|H["<b>Save/export</b>"]
  style H text-align:bottom
  G -->|Check user input| E
    subgraph OPTIONAL ["post-processing (optional)"]
    style OPTIONAL fill:#E4E4E4,stroke:#999,stroke-width:px,stroke-dasharray: 5 5
        direction LR
        X("- Resample data<br/>- Define segments<br/>- Define trips")
        style X text-align:left
    end
  G --> OPTIONAL --> H
  click A "#read-in-data-files";
  click B "#merge-with-metadata";
  click C "#merge-with-metadata";
  click D "#filtering-i";
  click E "#processing-i";
  click F "#summarise";
  click G "#visualisation-i";
  click H "#reprocessing-optional";
  click X "#save-export";
```

## OG figure with giant optional table

```{mermaid}
%%| fig-width: 11.5
%%| fig-cap: Original version of the workflow with full optional table (though for some reason the global spacing between nodes doesn't/can't be applied to subgraphs?)
%%{init:{'flowchart':{'nodeSpacing': 180, 'rankSpacing': 40}}}%%
flowchart LR
  A["<b>Read in data</b><br/>df_raw"] --> C{"<b>Merge</b><br/>df_metamerged"}
  B["<b>Read in metadata</b><br/>df_metadata"] --> C
  C --> D("<b>Filter</b><br/>df_clean")
  D --> E("<b>Process</b><br/>df_diagnostic")
  E --> F("<b>Summarise</b><br/>df_summary_inds<br/>df_summary_allinds")
  F --> G("<b>Visualise</b>")
  G --> H("<b>Save data for exporting</b>")
  H --> I("<b>SCIENCE</b>")
  G -->|Check user input| E
    subgraph OPTIONAL [OPTIONAL POST-PROCESSING STEPS]
    style OPTIONAL fill:#E4E4E4,stroke:#999,stroke-width:px,stroke-dasharray: 5 5
        direction LR
        id1("<b>Resample</b><br/>df_resample") --> id2(summarise) --> id3(visualise)
        id4("<b>Define segments</b><br/>df_segments") --> id5(summarise) --> id6(visualise)
        id7("<b>Define trips</b><br/>df_trips") --> id8("<b>summarise</b><br/>df_tripmetrics") --> id9(visualise)
    end
  G --> OPTIONAL --> H
  click A "#read-in-data-files";
```

## Figure with optional as a single box...

```{mermaid}
%%| fig-width: 9
%%| fig-cap: Edited version of workflow with optional box reduced to a single node
%%{init:{'flowchart':{'nodeSpacing': 180, 'rankSpacing': 40}}}%%
flowchart LR
  A["<b>Read in data</b><br/>df_raw"] --> C{"<b>Merge</b><br/>df_metamerged"}
  B["<b>Read in metadata</b><br/>df_metadata"] --> C
  C --> D("<b>Filter</b><br/>df_clean")
  D --> E("<b>Process</b><br/>df_diagnostic")
  E --> F("<b>Summarise</b><br/>df_summary_inds<br/>df_summary_allinds")
  F --> G("<b>Visualise</b>")
  G --> H("<b>Save data for exporting</b>")
  G -->|Check user input| E
    subgraph OPTIONAL [OPTIONAL POST-PROCESSING]
    style OPTIONAL fill:#E4E4E4,stroke:#999,stroke-width:px,stroke-dasharray: 5 5
        direction LR
        id1("<b>- Resample data<br/>- Define segments<br/>- Define trips</b>")
        style id1 text-align:left
    end
  G --> OPTIONAL --> H
  click A "#read-in-data-files";
```


### ...and separate figure?

```{mermaid}
%%| fig-cap: If we went for the above option then could add a full optional processing diagram above it's own section (though I don't think this approach is as good)
%%| fig-width: 5
%%{init:{'flowchart':{'nodeSpacing': 200, 'rankSpacing': 20}}}%%
flowchart LR
subgraph OPTIONAL
    style OPTIONAL fill:#E4E4E4,stroke:#999,stroke-width:px,stroke-dasharray: 5 5
        direction LR
        id1("<b>Resample</b><br/>df_resample") --> id2(summarise) --> id3(visualise)
        id4("<b>Define segments</b><br/>df_segments") --> id5(summarise) --> id6(visualise)
        id7("<b>Define trips</b><br/>df_trips") --> id8("<b>summarise</b><br/>df_tripmetrics") --> id9(visualise)
    end
  1A(Visualise) --> OPTIONAL --> 1B(Save) --> 1C(SCIENCE)
  click A "#read-in-data-files";
```



