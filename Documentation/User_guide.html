<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Alice Trevail">
<meta name="author" content="Stephen Lang">
<meta name="author" content="Luke Ozsanlav-Harris">
<meta name="author" content="Liam Langley">

<title>User guide</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="User_guide_files/libs/clipboard/clipboard.min.js"></script>
<script src="User_guide_files/libs/quarto-html/quarto.js"></script>
<script src="User_guide_files/libs/quarto-html/popper.min.js"></script>
<script src="User_guide_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="User_guide_files/libs/quarto-html/anchor.min.js"></script>
<link href="User_guide_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="User_guide_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="User_guide_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="User_guide_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="User_guide_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="User_guide_files/libs/quarto-diagram/mermaid.min.js"></script>
<script src="User_guide_files/libs/quarto-diagram/mermaid-init.js"></script>
<link href="User_guide_files/libs/quarto-diagram/mermaid.css" rel="stylesheet">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-full">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#pre-flight-checks" id="toc-pre-flight-checks" class="nav-link" data-scroll-target="#pre-flight-checks">0. Pre-flight checks</a></li>
  <li><a href="#read-in-data-files" id="toc-read-in-data-files" class="nav-link" data-scroll-target="#read-in-data-files">1. Read in data files</a></li>
  <li><a href="#merge-with-metadata" id="toc-merge-with-metadata" class="nav-link" data-scroll-target="#merge-with-metadata">2. Merge with metadata</a></li>
  <li><a href="#filtering-i" id="toc-filtering-i" class="nav-link" data-scroll-target="#filtering-i">3. Filtering I</a></li>
  <li><a href="#processing-i" id="toc-processing-i" class="nav-link" data-scroll-target="#processing-i">4. Processing I</a></li>
  <li><a href="#save-for-shiny" id="toc-save-for-shiny" class="nav-link" data-scroll-target="#save-for-shiny">5. Save for Shiny</a></li>
  <li><a href="#filtering-ii" id="toc-filtering-ii" class="nav-link" data-scroll-target="#filtering-ii">6. Filtering II</a>
  <ul class="collapse">
  <li><a href="#accessing-shiny-app" id="toc-accessing-shiny-app" class="nav-link" data-scroll-target="#accessing-shiny-app">Accessing Shiny App</a></li>
  </ul></li>
  <li><a href="#summarise-data" id="toc-summarise-data" class="nav-link" data-scroll-target="#summarise-data">7. Summarise data</a></li>
  <li><a href="#save-filtered-and-summary-data" id="toc-save-filtered-and-summary-data" class="nav-link" data-scroll-target="#save-filtered-and-summary-data">8. Save filtered and summary data</a></li>
  <li><a href="#visualisation-i" id="toc-visualisation-i" class="nav-link" data-scroll-target="#visualisation-i">9. Visualisation I</a></li>
  </ul>
</nav>
</div>
<main class="content column-page-left" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">User guide</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source" data-quarto-source-url="https://github.com/AliceTrevail/Code-workshop/blob/9f86b183880d9260c3c7f40007b7732566393d56/R/test.R"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Authors</div>
    <div class="quarto-title-meta-contents">
             <p>Alice Trevail <a href="https://orcid.org/0000-0002-6459-5213" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
             <p>Stephen Lang <a href="https://orcid.org/0000-0001-5820-4346" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
             <p>Luke Ozsanlav-Harris <a href="https://orcid.org/0000-0003-3889-6722" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
             <p>Liam Langley <a href="https://orcid.org/0000-0001-9754-6517" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>This user guide can be used as a walkthrough for reading and processing tracking data files with the <code>Workflow.R</code> script. You can use the example datasets provided in <code>Data</code>, or try with your own tracking data (see <a href="#pre-flight-checks">Pre-flight checks</a> for details on data requirements and structure).</p>
<p>The following diagram gives an overview of the workflow (boxes are hyperlinked to each section):</p>
<div class="cell" data-fig-width="9">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>%%{init:{'flowchart':{'nodeSpacing': 70, 'rankSpacing': 30}}}%%</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>flowchart LR</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  A[Read in data] --&gt; C{Merge}</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  B[Read in metadata] --&gt; C</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  C --&gt; D(Filter)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  D --&gt; E(Process)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  E --&gt; F(Save for Shiny)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  F --&gt; X(("Shiny app&lt;br/&gt;(optional)")) --&gt; G</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  F ---&gt;|Skip app|G(Filter II)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  G --&gt; H(Summarise)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  H --&gt; I(Save/export)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  H --&gt; J(Visualise)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    subgraph OPTIONAL ["post-processing (optional)"]</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    style OPTIONAL fill:#E4E4E4,stroke:#999,stroke-width:px,stroke-dasharray: 5 5</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>        direction LR</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>        Z("- Resample data&lt;br/&gt;- Define segments&lt;br/&gt;- Define trips")</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>        style Z text-align:left</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    end</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a> H --&gt; OPTIONAL</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  click A "#read-in-data-files";</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  click B "#merge-with-metadata";</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>  click C "#merge-with-metadata";</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>  click D "#filtering-i";</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>  click E "#processing-i";</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>  click F "#save-for-shiny";</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>  click G "#filtering-ii";</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>  click H "#summarise-data";</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>  click I "#save-filtered-and-summary-data";</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>  click J "#visualisation-i";</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<p>
</p><pre class="mermaid mermaid-js" data-tooltip-selector="#mermaid-tooltip-1">%%{init:{'flowchart':{'nodeSpacing': 70, 'rankSpacing': 30}}}%%
flowchart LR
  A[Read in data] --&gt; C{Merge}
  B[Read in metadata] --&gt; C
  C --&gt; D(Filter)
  D --&gt; E(Process)
  E --&gt; F(Save for Shiny)
  F --&gt; X(("Shiny app&lt;br/&gt;(optional)")) --&gt; G
  F ---&gt;|Skip app|G(Filter II)
  G --&gt; H(Summarise)
  H --&gt; I(Save/export)
  H --&gt; J(Visualise)
    subgraph OPTIONAL ["post-processing (optional)"]
    style OPTIONAL fill:#E4E4E4,stroke:#999,stroke-width:px,stroke-dasharray: 5 5
        direction LR
        Z("- Resample data&lt;br/&gt;- Define segments&lt;br/&gt;- Define trips")
        style Z text-align:left
    end
 H --&gt; OPTIONAL
  click A "#read-in-data-files";
  click B "#merge-with-metadata";
  click C "#merge-with-metadata";
  click D "#filtering-i";
  click E "#processing-i";
  click F "#save-for-shiny";
  click G "#filtering-ii";
  click H "#summarise-data";
  click I "#save-filtered-and-summary-data";
  click J "#visualisation-i";
</pre>
<div id="mermaid-tooltip-1" class="mermaidTooltip">

</div>
<p></p>
</div>
</div>
</div>
<section id="dependencies" class="level4">
<h4 class="anchored" data-anchor-id="dependencies">Dependencies:</h4>
<ul>
<li>This workflow uses the <a href="https://www.r-project.org/about.html">R programming language</a>, run via the <a href="https://www.rstudio.com/products/rstudio/">R Studio IDE</a></li>
<li>All code embraces the core principles of how to structure <a href="https://r4ds.had.co.nz/tidy-data.html">‘tidy data’</a></li>
<li>We use <a href="https://r4ds.had.co.nz/workflow-projects.html#rstudio-projects">RStudio projects</a> and the <a href="https://here.r-lib.org/"><code>here</code></a> package to build relative filepaths that are reproducible</li>
<li>Requires <a href="https://www.tidyverse.org/"><code>tidyverse</code></a>, <a href="https://github.com/Rdatatable/data.table"><code>data.table</code></a>, <a href="https://r-spatial.github.io/sf/"><code>sf</code></a> and <a href="https://here.r-lib.org/"><code>here</code></a> packages to be installed</li>
<li>Use our example data sets in the Data folder (RFB, GAN, SAP) or provide your own data</li>
</ul>
</section>
<section id="user-inputs" class="level4">
<h4 class="anchored" data-anchor-id="user-inputs">User inputs</h4>
<p>Some code chunks require editing by the user to match the specific dataset being used (particularly if you are using your own data), and are highlighted as below (the 🧠 indicates you will need to think about the structure and format of your data when making these edits!):</p>
<div class="callout-warning callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
🧠 User input required
</div>
</div>
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#--------------------#</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="do">## USER INPUT START ##</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">#--------------------#</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>example_input <span class="ot">&lt;-</span> <span class="st">"uservalue"</span> <span class="co"># In the R code, user input sections appear like this</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------#</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="do">## USER INPUT </span><span class="re">END</span><span class="do"> ##</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------#</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="pre-flight-checks" class="level2">
<h2 class="anchored" data-anchor-id="pre-flight-checks">0. Pre-flight checks</h2>
<section id="how-to-use-this-workflow" class="level5">
<h5 class="anchored" data-anchor-id="how-to-use-this-workflow">How to use this workflow:</h5>
<ul>
<li>We will inspect the data before reading it in, so there is no need to open it in another program (e.g., excel, which can corrupt dates and times)</li>
<li>User-defined parameters (see <a href="#user-inputs">user inputs</a>) are called within the subsequent processing steps</li>
<li>Where you see: <code>## ** Option ** ##</code>, there is an alternative version of the code to fit some common alternative data formats</li>
<li>Throughout, we will use some key functions to inspect the data (e.g., <code>head</code> for top rows, <code>str</code> for column types, and <code>names</code> for column names)</li>
</ul>
</section>
<section id="required-data-structure" class="level5">
<h5 class="anchored" data-anchor-id="required-data-structure">Required data structure:</h5>
<ul>
<li>Data files should all be stored in a specific folder (ideally within <code>Data</code>)</li>
<li>Data for each deployment/individual should be in a separate file</li>
<li>ID should be in tracking data file name, and should be the same length for all individuals</li>
<li>Tracking data must contain timestamp and at least one other sensor column</li>
<li>Metadata file should be in parent directory of data files</li>
<li>Metadata should contain one row per individual per deployment</li>
</ul>
</section>
<section id="the-importance-of-id" class="level5">
<h5 class="anchored" data-anchor-id="the-importance-of-id">The importance of ID:</h5>
<ul>
<li>Throughout this workflow, we use ID to refer to the unique code for an individual animal</li>
<li>In certain cases, you might have additional ID columns in the metadata (e.g., <code>DeployID</code>),</li>
<li>or read in data with a unique TagID instead of ID.</li>
<li>This code will work as long as all of the relevant info is included in the metadata</li>
<li>For more info and helpful code, see the FAQ document &amp; troubleshooting script</li>
</ul>
</section>
<section id="how-to-troubleshoot-problems-if-something-doesnt-work-with-your-data" class="level5">
<h5 class="anchored" data-anchor-id="how-to-troubleshoot-problems-if-something-doesnt-work-with-your-data">How to troubleshoot problems if something doesn’t work with your data:</h5>
<ul>
<li>Refer to the FAQ document in the github page</li>
<li>This signposts to helpful resources online (e.g., spatial co-ordinate systems)</li>
<li>See the troubleshooting code scripts that we’ve written to accompany this workflow</li>
<li>e.g., using multiple ID columns for re-deployments of tags/individuals</li>
</ul>
</section>
<section id="load-required-libraries" class="level5">
<h5 class="anchored" data-anchor-id="load-required-libraries">Load required libraries</h5>
<p>Just before starting we load in all the packages we will need for the workflow (also referenced in the <a href="#dependencies">Dependencies</a> section).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) <span class="co">#installed using install.packages("tidyverse")</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate) <span class="co">#installed with tidyverse but needs loading manually</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="read-in-data-files" class="level2">
<h2 class="anchored" data-anchor-id="read-in-data-files">1. Read in data files</h2>
<div class="callout-warning callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
🧠 User input required
</div>
</div>
<div class="callout-body-container callout-body">
<p>Set filepath for the folder containing raw data files (this code will try to open all files matching the file pattern within this folder, so it is best if this folder only contains the raw data files).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>filepath <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">"Data"</span>, <span class="st">"RFB"</span>) <span class="co">#create relative filepath using folder names</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Define common file pattern to look for. An asterisk (<code>*</code>) is the wildcard, will will match any character except a forward-slash (e.g.&nbsp;<code>*.csv</code> will import all files that end with “.csv”).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>filepattern <span class="ot">&lt;-</span> <span class="st">"*.csv"</span> <span class="co"># data file format (use "*.csv" to import all csv files within filepath folders)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s view the file names, to check that we have the files we want &amp; find ID position (this list will include names of sub-folders).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>ls_filenames <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="at">path =</span> filepath, <span class="at">recursive =</span> <span class="cn">TRUE</span>, <span class="at">pattern =</span> filepattern)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>ls_filenames</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "GV37501_201606_DG_RFB.csv" "GV37503_201606_DG_RFB.csv"
[3] "GV37734_201807_NI_RFB.csv"</code></pre>
</div>
</div>
<p>Adjust these numbers for extracting the ID number from file name using <a href="https://stringr.tidyverse.org/index.html"><code>stringr</code></a> (e.g.&nbsp;to extract GV37501 from “GV37501_201606_DG_RFB.csv”, we want characters 1-7). <br> <strong>NB:</strong> this approach only works if ID’s are in the same position — see the <a href="https://stringr.tidyverse.org/reference/str_sub.html"><code>str_sub</code></a> documentation for other options.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>IDstart <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co">#start position of the ID in the filename </span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>IDend <span class="ot">&lt;-</span> <span class="dv">7</span> <span class="co">#end position of the ID in the filename</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, let’s inspect the data by reading in the top of the first data file as raw text. To inspect the first row of all data files (if you wanted to check column names), you can remove the <code>[1]</code> and change <code>n_max = 1</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> fs<span class="sc">::</span><span class="fu">dir_ls</span>(<span class="at">path =</span> filepath, <span class="at">recurse =</span> <span class="cn">TRUE</span>, <span class="at">type =</span> <span class="st">"file"</span>,  <span class="at">glob =</span> filepattern)[<span class="dv">1</span>]</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">read_lines</span>(test, <span class="at">n_max =</span> <span class="dv">5</span>)  <span class="co"># change n_max to change the number of rows to read in</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Date, Time, Latitude, Longitude, Altitude, Speed, Course, Type, Distance"
[2] "24/06/2016,5.06,-7.261829,72.376091,56.18,3636,93,-2,0.00"               
[3] "24/06/2016, 05:21:39,-7.261829,72.376091,56.18,3636,93,0,0.00"           
[4] "24/06/2016, 05:29:50,-7.261744,72.376221,64.91,5112,32,0,17.17"          
[5] "24/06/2016, 05:54:28,-7.261623,72.376137,-15.77,936,291,0,16.34"         </code></pre>
</div>
</div>
<p>Define number of lines at top of file to skip (e.g.&nbsp;if importing a text file with additional info at top).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>skiplines <span class="ot">&lt;-</span> <span class="dv">0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Define date format(s) used (for passing to <a href="https://lubridate.tidyverse.org/reference/lubridate-package.html"><code>lubridate</code></a>) (<code>d</code> = day as decimal, <code>m</code> = month as decimal, <code>y</code> = year without century - 2 digits, <code>Y</code> = year with century - 4 digits). <code>Lubridate</code> can even parse more than one date/time format within a dataframe, so if your data include multiple formats, make sure they are all included. Here, we’ve included some common combinations:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>date_formats <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"dmY"</span>, <span class="st">"Ymd"</span>) <span class="co">#specify date formats (e.g. "dmY" works for 01-12-2022 and 01/12/2022)</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>datetime_formats <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Ymd HMS"</span>) <span class="co">#format used for date and time ("HMS" for hour, minutes and seconds)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Define time zone for tracking data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>trackingdatatimezone <span class="ot">&lt;-</span> <span class="st">"GMT"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>By default, the below code will find column names from the first row of data. If you want to specify your own column names, do so here as a character vector, or use <code>set colnames &lt;- FALSE</code> to automatically number columns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>colnames <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here, we use the function <code>read_delim</code> and specify the delimiter to make this code more universal (you can find extra information on this in the <a href="https://readr.tidyverse.org/reference/read_delim.html"><code>readr</code> documentation</a>).</p>
<p>Some delimiter examples:</p>
<ul>
<li><code>","</code> = comma delimited (equivalent to using <code>read_csv</code> – saved as extension <code>.csv</code>)</li>
<li><code>"\t"</code> = tab delimited (equivalent to using <code>read_tsv</code> — saved as extension <code>.tsv</code>)</li>
<li><code>" "</code> = whitespace delimited (equivalent to using <code>read_table</code>)</li>
</ul>
<p>Let’s inspect the data again, this time skipping rows if set, to check the file delimiter.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read_lines</span>(test, <span class="at">n_max =</span> <span class="dv">5</span>, <span class="at">skip =</span> skiplines)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Date, Time, Latitude, Longitude, Altitude, Speed, Course, Type, Distance"
[2] "24/06/2016,5.06,-7.261829,72.376091,56.18,3636,93,-2,0.00"               
[3] "24/06/2016, 05:21:39,-7.261829,72.376091,56.18,3636,93,0,0.00"           
[4] "24/06/2016, 05:29:50,-7.261744,72.376221,64.91,5112,32,0,17.17"          
[5] "24/06/2016, 05:54:28,-7.261623,72.376137,-15.77,936,291,0,16.34"         </code></pre>
</div>
</div>
<p>Set delimiter to use within <code>read_delim</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>user_delim <span class="ot">&lt;-</span> <span class="st">","</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>user_trim_ws <span class="ot">&lt;-</span> <span class="cn">TRUE</span> <span class="co"># Should leading/trailing whitespaces be trimmed from each field before parsing?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<section id="read-in-and-merge-all-tracking-data-files" class="level4 tabset">
<h4 class="tabset anchored" data-anchor-id="read-in-and-merge-all-tracking-data-files">Read in and merge all tracking data files</h4>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" href="">tidyr</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false" href="">tidyr with IDs (option)</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false" href="">baseR (option)</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>df_combined <span class="ot">&lt;-</span> fs<span class="sc">::</span><span class="fu">dir_ls</span>(<span class="at">path =</span> filepath, <span class="co">#use our defined filepath</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">glob =</span> filepattern, <span class="co">#use our defined filepattern</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">type =</span> <span class="st">"file"</span>,  <span class="co">#only search for files</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">recurse =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="co">#search all sub-folders</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">set_names</span>(<span class="at">nm =</span> <span class="fu">basename</span>(.)) <span class="sc">%&gt;%</span> <span class="co">#removing path prefix</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map_dfr</span>(read_delim, <span class="at">.id=</span><span class="st">"filename"</span>, <span class="co">#read all files using filename as ID column</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">col_types =</span> <span class="fu">cols</span>(<span class="at">.default =</span> <span class="st">"c"</span>), <span class="co">#read all columns as characters</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">col_names =</span> colnames, <span class="co">#use our defined colnames</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">skip =</span> skiplines, <span class="co">#user defined skiplines</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>                 <span class="at">delim =</span> user_delim, </span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>                 <span class="at">trim_ws =</span> user_trim_ws) <span class="sc">%&gt;%</span>  </span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ID =</span> <span class="fu">str_sub</span>(<span class="at">string =</span> filename, <span class="co">#extract ID from filename</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>                      <span class="at">start =</span> IDstart, <span class="at">end =</span> IDend), <span class="co">#user-defined string positions</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">.after =</span> filename) <span class="co">#reposition the new ID column</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>df_combined</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6,650 × 12
   filename ID    Date  Time  Latit…¹ Longi…² Altit…³ Speed Course Type  Dista…⁴
   &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;  
 1 GV37501… GV37… 24/0… 5.06  -7.261… 72.376… 56.18   3636  93     -2    0.00   
 2 GV37501… GV37… 24/0… 05:2… -7.261… 72.376… 56.18   3636  93     0     0.00   
 3 GV37501… GV37… 24/0… 05:2… -7.261… 72.376… 64.91   5112  32     0     17.17  
 4 GV37501… GV37… 24/0… 05:5… -7.261… 72.376… -15.77  936   291    0     16.34  
 5 GV37501… GV37… 24/0… 06:2… -7.261… 72.376… 30.91   1080  124    0     22.06  
 6 GV37501… GV37… 24/0… 06:2… -7.261… 72.376… 26.8    0     280    0     6.26   
 7 GV37501… GV37… 24/0… 06:3… -7.261… 72.376… 21.77   0     183    0     10.73  
 8 GV37501… GV37… 24/0… 06:3… -7.261… 72.376… 30.78   2844  268    0     1.84   
 9 GV37501… GV37… 24/0… 06:4… -7.261… 72.376… 27.1    1476  44     0     8.38   
10 GV37501… GV37… 24/0… 06:4… -7.261… 72.375… -35.04  0     260    0     60.99  
# … with 6,640 more rows, 1 more variable: Essential &lt;chr&gt;, and abbreviated
#   variable names ¹​Latitude, ²​Longitude, ³​Altitude, ⁴​Distance</code></pre>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p>If your data are combined into one or multiple csv files already containing an ID column, use the following code (this is the same as the normal tidyr pipe, but doesn’t create a new ID column from the file name):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="do">## ** Option ** ##</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>df_combined <span class="ot">&lt;-</span> fs<span class="sc">::</span><span class="fu">dir_ls</span>(<span class="at">path =</span> filepath, <span class="at">glob =</span> filepattern, <span class="co">#use our defined filepath and pattern</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">type =</span> <span class="st">"file"</span>, <span class="at">recurse =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="co"># recurse = T searches all sub-folders</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>   purrr<span class="sc">::</span><span class="fu">map_dfr</span>(read_delim, <span class="at">col_types =</span> <span class="fu">cols</span>(<span class="at">.default =</span> <span class="st">"c"</span>), <span class="at">col_names =</span> colnames, </span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">skip =</span> skiplines, <span class="at">delim =</span> user_delim, <span class="at">trim_ws =</span> user_trim_ws) </span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>df_combined</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<p>This is how you would read in data with base R code.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>raw_filenames <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="at">path =</span> filepath, <span class="at">recursive=</span><span class="cn">TRUE</span>, <span class="at">pattern=</span><span class="st">".csv"</span>, <span class="at">full.names =</span> T)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>ls_raw_files <span class="ot">&lt;-</span><span class="fu">lapply</span>(raw_filenames, <span class="cf">function</span>(x){<span class="fu">fread</span>(x)})</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(ls_raw_files) <span class="ot">&lt;-</span> raw_filenames</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ls_raw_files)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>df_combined <span class="ot">&lt;-</span> <span class="fu">rbindlist</span>(ls_raw_files, <span class="at">idcol =</span> <span class="st">"filepath"</span>, <span class="at">fill =</span> T) <span class="co">#rbind with data table and save ID column </span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>df_combined<span class="sc">$</span>ID <span class="ot">&lt;-</span> <span class="fu">str_sub</span>(df_combined<span class="sc">$</span>filepath, <span class="at">start=</span>IDstart, <span class="at">end=</span>IDend) <span class="co">#extract ID string from filename</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="slim-down-dataset" class="level4 tabset">
<h4 class="tabset anchored" data-anchor-id="slim-down-dataset">Slim down dataset</h4>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true" href="">Select normal columns</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false" href="">Select custom columns (option)</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="callout-warning callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
🧠 User input required
</div>
</div>
<div class="callout-body-container callout-body">
<p>Here we select necessary columns &amp; coerce column names</p>
<ul>
<li>Compulsory columns = ID, Date &amp; Time (or single DateTime column?)</li>
<li>Optional columns depending on sensor type, e.g.&nbsp;Lat, Lon, error</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>df_slim <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">ID =</span> df_combined<span class="sc">$</span>ID,</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">Date =</span> df_combined<span class="sc">$</span>Date,</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">Time =</span> df_combined<span class="sc">$</span>Time,</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">Lat =</span> df_combined<span class="sc">$</span>Latitude,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">Lon =</span> df_combined<span class="sc">$</span>Longitude)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_slim)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       ID       Date     Time       Lat       Lon
1 GV37501 24/06/2016     5.06 -7.261829 72.376091
2 GV37501 24/06/2016 05:21:39 -7.261829 72.376091
3 GV37501 24/06/2016 05:29:50 -7.261744 72.376221
4 GV37501 24/06/2016 05:54:28 -7.261623 72.376137
5 GV37501 24/06/2016 06:22:02 -7.261651 72.376335
6 GV37501 24/06/2016 06:27:16 -7.261618 72.376289</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="callout-warning callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
🧠 User input required
</div>
</div>
<div class="callout-body-container callout-body">
<p>Here’s an example of how to change the above code for data with different columns and column names. This code works with immersion data recorded by a GLS logger (no location data)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>df_slim <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">ID =</span> df_combined<span class="sc">$</span>ID,</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">Date =</span> df_combined<span class="sc">$</span><span class="st">`</span><span class="at">DD/MM/YYYY</span><span class="st">`</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">Time =</span> df_combined<span class="sc">$</span><span class="st">`</span><span class="at">HH:MM:SS</span><span class="st">`</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">Immersion =</span> df_combined<span class="sc">$</span><span class="st">`</span><span class="at">wets0-20</span><span class="st">`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="dates-and-times" class="level4 tabset">
<h4 class="tabset anchored" data-anchor-id="dates-and-times">Dates and Times</h4>
<p>Now our <code>df_slim</code> is ready, we need to create a <code>DateTime</code> column. We can either parse <code>Date</code> and <code>Time</code> columns separately and combine, or parse a single <code>DateTime</code> column (if already present):</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true" href="">Date + Time</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false" href="">DateTime (option)</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<p>If your date and time are in separate columns, create <code>Datetime</code> by appending <code>Time</code> to <code>Date</code> object using <code>parse_date_time</code>)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>df_slim<span class="sc">$</span>Date <span class="ot">&lt;-</span> lubridate<span class="sc">::</span><span class="fu">parse_date_time</span>(df_slim<span class="sc">$</span>Date, <span class="co">#parse date column</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">orders =</span> date_formats) </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>df_slim<span class="sc">$</span>DateTime <span class="ot">&lt;-</span> lubridate<span class="sc">::</span><span class="fu">parse_date_time</span>(<span class="fu">paste</span>(df_slim<span class="sc">$</span>Date, df_slim<span class="sc">$</span>Time), <span class="co">#create DateTime object</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">orders =</span> datetime_formats, </span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">tz =</span> trackingdatatimezone) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: 1 failed to parse.</code></pre>
</div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>failed to parse</code> warnings mean a date or time has not formatted (dealt with later)</p>
</div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<p>If date and time are already combined in one column (named <code>DateTime</code>), parse to ensure correct format &amp; time zone</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="do">## ** Option ** ##</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>df_slim<span class="sc">$</span>DateTime <span class="ot">&lt;-</span> lubridate<span class="sc">::</span><span class="fu">parse_date_time</span>(df_slim<span class="sc">$</span>DateTime, </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">orders =</span> datetime_formats, </span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">tz =</span> trackingdatatimezone)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>failed to parse</code> warnings mean a date or time has not formatted (dealt with later)</p>
</div>
</div>
</div>
</div>
</div>
<p>Lastly, we make a <code>df_raw</code> dataframe by sorting using ID and DateTime, dropping NA’s in DateTime column</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>df_raw <span class="ot">&lt;-</span> df_slim <span class="sc">%&gt;%</span> </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(ID, DateTime) <span class="sc">%&gt;%</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(DateTime) <span class="co">#remove NA's in datetime column</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_raw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       ID       Date     Time       Lat       Lon            DateTime
1 GV37501 2016-06-24 05:21:39 -7.261829 72.376091 2016-06-24 05:21:39
2 GV37501 2016-06-24 05:29:50 -7.261744 72.376221 2016-06-24 05:29:50
3 GV37501 2016-06-24 05:54:28 -7.261623 72.376137 2016-06-24 05:54:28
4 GV37501 2016-06-24 06:22:02 -7.261651 72.376335 2016-06-24 06:22:02
5 GV37501 2016-06-24 06:27:16 -7.261618 72.376289 2016-06-24 06:27:16
6 GV37501 2016-06-24 06:32:27 -7.261584 72.376198 2016-06-24 06:32:27</code></pre>
</div>
</div>
<p>We can clean up intermediate files/objects by listing everything we want to keep (i.e.&nbsp;remove everything else)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>()[<span class="sc">!</span><span class="fu">ls</span>() <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"df_raw"</span>, </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"date_formats"</span>,<span class="st">"datetime_formats"</span>,<span class="st">"trackingdatatimezone"</span>)]) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="merge-with-metadata" class="level2">
<h2 class="anchored" data-anchor-id="merge-with-metadata">2. Merge with metadata</h2>
<p>Metadata are an essential piece of information for any tracking study, as they contain important information about each of your data files, such as tag ID, animal ID, or deployment information, that we can add back into to our raw data when needed. For example, this is what the first few columns of a metadata file looks like for our example Red Footed Booby data:</p>
<table class="table">
<colgroup>
<col style="width: 7%">
<col style="width: 11%">
<col style="width: 12%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 6%">
<col style="width: 19%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">TagID</th>
<th style="text-align: center;">BirdID</th>
<th style="text-align: center;">DeployID</th>
<th style="text-align: center;">Species</th>
<th style="text-align: center;">Colony</th>
<th style="text-align: center;">Age</th>
<th>BreedingStage</th>
<th>DeploymentDate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">5</td>
<td style="text-align: center;">GV37501</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">RFB</td>
<td style="text-align: center;">DG</td>
<td style="text-align: center;">Adult</td>
<td>Chick rearing</td>
<td>25/06/2016</td>
</tr>
<tr class="even">
<td style="text-align: center;">46</td>
<td style="text-align: center;">GV37503</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">RFB</td>
<td style="text-align: center;">DG</td>
<td style="text-align: center;">Adult</td>
<td>Chick rearing</td>
<td>26/06/2016</td>
</tr>
<tr class="odd">
<td style="text-align: center;">5</td>
<td style="text-align: center;">GV37734</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">RFB</td>
<td style="text-align: center;">NI</td>
<td style="text-align: center;">Adult</td>
<td>Chick rearing</td>
<td>08/07/2018</td>
</tr>
</tbody>
</table>
<div class="callout-warning callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
🧠 User input required
</div>
</div>
<div class="callout-body-container callout-body">
<p>First we define the path to our metadata file:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>filepath_meta <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">"Data"</span>,<span class="st">"RFB_Metadata.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then much like in Step 1, we define the date format(s) used (for passing to <a href="https://lubridate.tidyverse.org/reference/lubridate-package.html"><code>lubridate</code></a>) (<code>d</code> = day as decimal, <code>m</code> = month as decimal, <code>y</code> = year without century - 2 digits, <code>Y</code> = year with century - 4 digits). Here, we’ve included common combinations, which you’ll need to modify if your metadata include a different format.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>metadate_formats <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"dmY"</span>, <span class="st">"Ymd"</span>) <span class="co">#specify date format used in metadata</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>metadatetime_formats <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"dmY HMS"</span>, <span class="st">"Ymd HMS"</span>) <span class="co">#specify date &amp; time format</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>metadatatimezone <span class="ot">&lt;-</span> <span class="st">"Indian/Chagos"</span> <span class="co">#specify timezone used for metadata</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next we read in the metadata file (make sure to check data format matches the <code>read_</code> function used).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>df_metadata <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(filepath_meta) <span class="co">#read in the metadata file</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(df_metadata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then we select necessary comments &amp; coerce column names, making sure to provide four compulsory columns: <strong>ID</strong>, <strong>deployment date</strong> &amp; <strong>deployment time</strong>. We can also provide optional columns depending on sensor type: e.g.&nbsp;colony, sex, age, central place (CP) Lat, CP Lon. Depending on whether you know the CP for each individual, you can use one of the two following approaches, and delete columns where appropriate.</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true" href="">Select metadata columns</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false" href="">Individual CP unknown (option)</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<p>If you have multiple ID columns like TagID/DeployID, include them here (for example, if one individual was tracked over multiple deployments/years, or if one tag was re-deployed on multiple individuals). For more information and helpful code, see the <a href="FAQ's.html">FAQ document</a> and <a href="https://github.com/AliceTrevail/Code-workshop/blob/c815d760947d7f608ff9aeeaa902f3aa878b7cdc/R/Troubleshoot%20-%20multiple%20ID%20columns.R">troubleshooting script</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>df_metadataslim <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">ID =</span> df_metadata<span class="sc">$</span>BirdID,</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>                              <span class="at">DeployID =</span> df_metadata<span class="sc">$</span>DeployID,</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>                              <span class="at">DeployDate_local =</span> df_metadata<span class="sc">$</span>DeploymentDate, <span class="co"># note "local" in colname</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>                              <span class="at">DeployTime_local =</span> df_metadata<span class="sc">$</span>DeploymentTime, <span class="co"># note "local" in colname</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>                              <span class="at">RetrieveDate_local =</span> df_metadata<span class="sc">$</span>RetrievalDate, <span class="co"># note "local" in colname</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>                              <span class="at">RetrieveTime_local =</span> df_metadata<span class="sc">$</span>RetrievalTime, <span class="co"># note "local" in colname</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>                              <span class="at">CPLat =</span> df_metadata<span class="sc">$</span>NestLat,</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>                              <span class="at">CPLon =</span> df_metadata<span class="sc">$</span>NestLong,</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>                              <span class="at">Species =</span> df_metadata<span class="sc">$</span>Species,</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>                              <span class="at">Population =</span> df_metadata<span class="sc">$</span>Population,</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>                              <span class="at">Age =</span> df_metadata<span class="sc">$</span>Age, </span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>                              <span class="at">BreedingStage =</span> df_metadata<span class="sc">$</span>BreedingStage)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<p>If central place for each individual is not known, add population-level central places here by first creating a custom dataframe of population CPs:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="do">## ** Option ** ##</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>df_PopCPs <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>Population,  <span class="sc">~</span>CPLat,    <span class="sc">~</span>CPLon,</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"DG"</span>,         <span class="sc">-</span><span class="fl">7.24</span>,     <span class="fl">72.43</span>,</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"NI"</span>,         <span class="sc">-</span><span class="fl">5.68</span>,     <span class="fl">71.24</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then we merge <code>df_metadataslim</code> and <code>df_PopCPs.</code> The <code>Population</code> column must be present in both dataframes (this will overwrite <code>CPLat</code> and <code>CPLon</code> if present in <code>df_metadataslim</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>df_metadataslim  <span class="sc">%&lt;&gt;%</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">matches</span>(<span class="fu">setdiff</span>(<span class="fu">names</span>(df_metadataslim), <span class="fu">c</span>(<span class="st">"CPLat"</span>, <span class="st">"CPLon"</span>)))) <span class="sc">%&gt;%</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(., df_PopCPs, <span class="at">by =</span> <span class="st">"Population"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<p>Format all dates and times, combine them and specify timezone (tz)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>df_metadataslim <span class="ot">&lt;-</span> df_metadataslim <span class="sc">%&gt;%</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">contains</span>(<span class="st">'Date'</span>), </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>                <span class="sc">~</span><span class="fu">parse_date_time</span>(., <span class="at">orders=</span>metadate_formats))) <span class="sc">%&gt;%</span> <span class="co">#format all Date column with lubridate</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Deploydatetime =</span> <span class="fu">parse_date_time</span>(<span class="fu">paste</span>(DeployDate_local, DeployTime_local),<span class="co">#create deploy datetime</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">order=</span>metadatetime_formats, </span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">tz=</span>metadatatimezone),</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">Retrievedatetime =</span> <span class="fu">parse_date_time</span>(<span class="fu">paste</span>(RetrieveDate_local, RetrieveTime_local), <span class="co">#create retrieve datetime</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">order=</span>metadatetime_formats, </span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">tz=</span>metadatatimezone)) <span class="sc">%&gt;%</span> </span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(DeployDate_local,DeployTime_local,RetrieveDate_local,RetrieveTime_local)) <span class="sc">%&gt;%</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">contains</span>(<span class="st">'datetime'</span>), <span class="co">#return datetime as it would appear in a different tz</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>                <span class="sc">~</span><span class="fu">with_tz</span>(., <span class="at">tzone=</span>trackingdatatimezone))) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Merge metadata with raw data using ID column</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>df_metamerged <span class="ot">&lt;-</span> df_raw <span class="sc">%&gt;%</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(., df_metadataslim, <span class="at">by=</span><span class="st">"ID"</span>) <span class="co">#add metadata to summarised data (nest lat/long)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Remove intermediate files/objects by specifying objects to keep.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>()[<span class="sc">!</span><span class="fu">ls</span>() <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"df_metamerged"</span>)]) <span class="co">#specify objects to keep</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="filtering-i" class="level2">
<h2 class="anchored" data-anchor-id="filtering-i">3. Filtering I</h2>
<div class="callout-warning callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
🧠 User input required
</div>
</div>
<div class="callout-body-container callout-body">
<p>Define your own no/empty/erroneous data values in <code>Lat</code> and <code>Lon</code> columns (e.g.&nbsp;“bad” values specified by the tag manufacturer).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>No_data_vals <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="sc">-</span><span class="dv">999</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Define a vector of columns which can’t have NAs</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>na_cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Lat"</span>, <span class="st">"Lon"</span>, <span class="st">"DateTime"</span>, <span class="st">"ID"</span>) <span class="co">#column to check for na's</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>Now we pipe the data through a series of functions to drop NAs in specified columns, filter out user-defined <code>no_data_values</code> in <code>Lat</code> <code>Lon</code> columns, remove duplicates, remove undeployed locations and filter out locations within temporal cut-off following deployment.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>df_clean <span class="ot">&lt;-</span> df_metamerged <span class="sc">%&gt;%</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>              <span class="fu">drop_na</span>(<span class="fu">all_of</span>(na_cols)) <span class="sc">%&gt;%</span> </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>              <span class="fu">filter</span>(<span class="sc">!</span>Lat <span class="sc">%in%</span> No_data_vals <span class="sc">&amp;</span> <span class="sc">!</span>Lon <span class="sc">%in%</span> No_data_vals) <span class="sc">%&gt;%</span> <span class="co"># filter bad data values in Lat Lon columns</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>              <span class="fu">distinct</span>(DateTime, ID, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="co"># if you have ACC data this might cause issues</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>              <span class="fu">filter</span>(Deploydatetime <span class="sc">&lt;</span> DateTime <span class="sc">&amp;</span> DateTime <span class="sc">&lt;</span> Retrievedatetime) <span class="co"># filter to deployment period, only</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_clean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       ID       Date     Time       Lat       Lon            DateTime DeployID
1 GV37501 2016-06-25 10:27:56 -7.238936 72.435043 2016-06-25 10:27:56        1
2 GV37501 2016-06-25 10:33:13 -7.238903 72.435005 2016-06-25 10:33:13        1
3 GV37501 2016-06-25 10:38:19 -7.238754 72.434944 2016-06-25 10:38:19        1
4 GV37501 2016-06-25 10:43:46 -7.238957 72.435188 2016-06-25 10:43:46        1
5 GV37501 2016-06-25 10:49:02 -7.239048 72.435059 2016-06-25 10:49:02        1
6 GV37501 2016-06-25 10:54:38 -7.238441 72.434708 2016-06-25 10:54:38        1
    CPLat   CPLon Species Population   Age BreedingStage      Deploydatetime
1 -7.2386 72.4347     RFB         DG Adult Chick rearing 2016-06-25 10:25:00
2 -7.2386 72.4347     RFB         DG Adult Chick rearing 2016-06-25 10:25:00
3 -7.2386 72.4347     RFB         DG Adult Chick rearing 2016-06-25 10:25:00
4 -7.2386 72.4347     RFB         DG Adult Chick rearing 2016-06-25 10:25:00
5 -7.2386 72.4347     RFB         DG Adult Chick rearing 2016-06-25 10:25:00
6 -7.2386 72.4347     RFB         DG Adult Chick rearing 2016-06-25 10:25:00
     Retrievedatetime
1 2016-06-29 03:32:00
2 2016-06-29 03:32:00
3 2016-06-29 03:32:00
4 2016-06-29 03:32:00
5 2016-06-29 03:32:00
6 2016-06-29 03:32:00</code></pre>
</div>
</div>
<p>Finally we remove intermediate files/objects</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>()[<span class="sc">!</span><span class="fu">ls</span>() <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"df_clean"</span>)]) <span class="co">#specify objects to keep</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="processing-i" class="level2">
<h2 class="anchored" data-anchor-id="processing-i">4. Processing I</h2>
<section id="some-useful-temporal-and-spatial-calculations-on-the-data" class="level4">
<h4 class="anchored" data-anchor-id="some-useful-temporal-and-spatial-calculations-on-the-data">Some useful temporal and spatial calculations on the data</h4>
<div class="callout-warning callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
🧠 User input required
</div>
</div>
<div class="callout-body-container callout-body">
<p>First we need to specify the co-ordinate projection systems for the tracking data and meta data. The default here is lon/lat for both tracking data &amp; metadata, for which the EPSG code is 4326. For more information see the <a href="FAQ's.html#what-is-a-crs">CRS section of the FAQ’s</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>tracking_crs <span class="ot">&lt;-</span> <span class="dv">4326</span> <span class="co">#Only change if data are in a different coordinate system</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>meta_crs <span class="ot">&lt;-</span> <span class="dv">4326</span> <span class="co">#Only change if data are in a different coordinate system</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>Next we transform coordinates of data, and perform spatial calculations. This requires spatial analysis, and so it is good practice to run all spatial analyses in a coordinate reference system that uses metres as a unit.</p>
<p>As an example, we will use Spherical Mercator projection — <em>aka</em> “WGS” (crs = 3857). It’s important to consider the location and scale of your data (e.g., equatorial/polar/local scale/global scale) when choosing a projection system.</p>
<p>Depending on whether you know the central place (CP) for each individual, you can use one of the two following approaches:</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true" href="">With CP data</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false" href="">Without CP data</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<p>This is how we calculate bearings relative to CP:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>df_diagnostic <span class="ot">&lt;-</span>  df_clean <span class="sc">%&gt;%</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="co">#need to ungroup to extract geometry of the whole dataset</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">geometry_GPS =</span> <span class="fu">st_transform</span>( <span class="co">#assign geometry and transform to WGS for dist calcs</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>            <span class="fu">st_as_sf</span>(., <span class="at">coords=</span><span class="fu">c</span>(<span class="st">"Lon"</span>,<span class="st">"Lat"</span>), <span class="at">crs=</span>tracking_crs), <span class="at">crs =</span> <span class="dv">3857</span>)<span class="sc">$</span>geometry,</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">geometry_CP =</span> <span class="fu">st_transform</span>( <span class="co">#assign geometry and transform to WGS for dist calcs</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">st_as_sf</span>(., <span class="at">coords=</span><span class="fu">c</span>(<span class="st">"CPLon"</span>,<span class="st">"CPLat"</span>), <span class="at">crs=</span>meta_crs), <span class="at">crs =</span> <span class="dv">3857</span>)<span class="sc">$</span>geometry) <span class="sc">%&gt;%</span> </span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID) <span class="sc">%&gt;%</span> <span class="co">#back to grouping by ID for calculations per individual</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dist =</span> <span class="fu">st_distance</span>(geometry_GPS, <span class="fu">lag</span>(geometry_GPS), <span class="at">by_element =</span> T), <span class="co">#distance travelled from previous fix</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">difftime =</span> <span class="fu">difftime</span>(DateTime, <span class="fu">lag</span>(DateTime), <span class="at">units=</span><span class="st">"secs"</span>), <span class="co">#time passed since previous fix</span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">netdisp =</span> <span class="fu">st_distance</span>(geometry_GPS, geometry_GPS[<span class="dv">1</span>], <span class="at">by_element =</span> T), <span class="co">#calculate distance to first location</span></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">speed =</span> <span class="fu">as.numeric</span>(dist)<span class="sc">/</span><span class="fu">as.numeric</span>(difftime), <span class="co">#calculate speed (distance/time)</span></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">dLon =</span> <span class="fu">as.numeric</span>(Lon)<span class="sc">-</span><span class="fu">lag</span>(<span class="fu">as.numeric</span>(Lon)), <span class="co">#difference in longitude, relative to previous location</span></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">dLat =</span> <span class="fu">as.numeric</span>(Lat)<span class="sc">-</span><span class="fu">lag</span>(<span class="fu">as.numeric</span>(Lat)), <span class="co">#difference in longitude, relative to previous location</span></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">turnangle =</span> <span class="fu">atan2</span>(dLon, dLat)<span class="sc">*</span><span class="dv">180</span><span class="sc">/</span>pi <span class="sc">+</span> (dLon <span class="sc">&lt;</span> <span class="dv">0</span>)<span class="sc">*</span><span class="dv">360</span>, <span class="co">#angle (in degrees) from previous to current location</span></span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">CPdist =</span> <span class="fu">st_distance</span>(geometry_GPS, geometry_CP, <span class="at">by_element =</span> T), <span class="co">#calculate distance to CP</span></span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">dLon_CP =</span> <span class="fu">as.numeric</span>(Lon)<span class="sc">-</span>CPLon, <span class="co">#difference in longitude to CP</span></span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">dLat_CP =</span> <span class="fu">as.numeric</span>(Lat)<span class="sc">-</span>CPLat, <span class="co">#difference in longitude to CP</span></span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">CPbearing =</span> <span class="fu">atan2</span>(dLon_CP, dLat_CP)<span class="sc">*</span><span class="dv">180</span><span class="sc">/</span>pi <span class="sc">+</span> (dLon_CP <span class="sc">&lt;</span> <span class="dv">0</span>)<span class="sc">*</span><span class="dv">360</span>) <span class="sc">%&gt;%</span> <span class="co">#bearing (in degrees) from CP</span></span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(geometry_GPS, geometry_CP, dLon, dLat, dLon_CP, dLat_CP)) <span class="co">#ungroup and remove geometries</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<p>If your data do not include a Central Place, you can use the below code to calculate bearings relative to first location instead:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="do">## ** Option ** ##</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>df_diagnostic <span class="ot">&lt;-</span>  df_clean <span class="sc">%&gt;%</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="co">#need to ungroup to extract geometry of the whole dataset</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">geometry_GPS =</span> <span class="fu">st_transform</span>( <span class="co"># assign geometry and transform to WGS for dist calcs</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>            <span class="fu">st_as_sf</span>(., <span class="at">coords=</span><span class="fu">c</span>(<span class="st">"Lon"</span>,<span class="st">"Lat"</span>), <span class="at">crs=</span>tracking_crs), <span class="at">crs =</span> <span class="dv">3857</span>)<span class="sc">$</span>geometry) <span class="sc">%&gt;%</span> </span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID) <span class="sc">%&gt;%</span> <span class="co">#back to grouping by ID for calculations per individual</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dist =</span> <span class="fu">st_distance</span>(geometry_GPS, <span class="fu">lag</span>(geometry_GPS), <span class="at">by_element =</span> T), <span class="co">#distance travelled from previous fix</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">difftime =</span> <span class="fu">difftime</span>(DateTime, <span class="fu">lag</span>(DateTime), <span class="at">units=</span><span class="st">"secs"</span>), <span class="co">#time passed since previous fix</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">netdisp =</span> <span class="fu">st_distance</span>(geometry_GPS, geometry_GPS[<span class="dv">1</span>], <span class="at">by_element =</span> T), <span class="co">#calculate distance to first location</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">speed =</span> <span class="fu">as.numeric</span>(dist)<span class="sc">/</span><span class="fu">as.numeric</span>(difftime), <span class="co">#calculate speed (distance/time)</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">dLon =</span> <span class="fu">as.numeric</span>(Lon)<span class="sc">-</span><span class="fu">lag</span>(<span class="fu">as.numeric</span>(Lon)), <span class="co">#difference in longitude, relative to previous location</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">dLat =</span> <span class="fu">as.numeric</span>(Lat)<span class="sc">-</span><span class="fu">lag</span>(<span class="fu">as.numeric</span>(Lat)), <span class="co">#difference in longitude, relative to previous location</span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">turnangle =</span> <span class="fu">atan2</span>(dLon, dLat)<span class="sc">*</span><span class="dv">180</span><span class="sc">/</span>pi <span class="sc">+</span> (dLon <span class="sc">&lt;</span> <span class="dv">0</span>)<span class="sc">*</span><span class="dv">360</span>, <span class="co">#angle from previous to current location</span></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">dLon_net =</span> <span class="fu">as.numeric</span>(Lon)<span class="sc">-</span><span class="fu">as.numeric</span>(Lon)[<span class="dv">1</span>], <span class="co">#difference in longitude between current and first location</span></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">dLat_net =</span> <span class="fu">as.numeric</span>(Lat)<span class="sc">-</span><span class="fu">as.numeric</span>(Lat)[<span class="dv">1</span>], <span class="co">#difference in longitude between current and first location</span></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">netbearing =</span> <span class="fu">atan2</span>(dLon_net, dLat_net)<span class="sc">*</span><span class="dv">180</span><span class="sc">/</span>pi <span class="sc">+</span> (dLon_net <span class="sc">&lt;</span> <span class="dv">0</span>)<span class="sc">*</span><span class="dv">360</span>) <span class="sc">%&gt;%</span> <span class="co">#bearing from first to current location</span></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>   <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(geometry_GPS, dLon, dLat, dLon_net, dLat_net)) <span class="co">#ungroup and remove geometries</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="save-for-shiny" class="level2">
<h2 class="anchored" data-anchor-id="save-for-shiny">5. Save for Shiny</h2>
<p>Here we’re going to save <code>df_diagnostic</code> to use in the shiny app provided. The app is designed to explore how further filtering and processing steps affect the data.</p>
<div class="callout-warning callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
🧠 User input required
</div>
</div>
<div class="callout-body-container callout-body">
<p>First we’ll add species code, as it’s good practice to include species in the data frame &amp; file name</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>species_code <span class="ot">&lt;-</span> <span class="st">"RFB"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then we define a file path for saving the working dataframe files (if you’re defining a new folder, make sure to create it before attempting to save into it).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>filepath_dfout <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">"DataOutputs"</span>,<span class="st">"WorkingDataFrames"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next we define file name for the saved file by pasting the species code to <code>_diagnostic</code> (can change if you want to use a different naming system).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>filename_dfout <span class="ot">&lt;-</span> <span class="fu">paste0</span>(species_code, <span class="st">"_diagnostic"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If not added from the metadata, add a species column and any other columns here relevant to your data <em>(optional)</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="do">## ** Option ** ##</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>df_diagnostic<span class="sc">$</span>Species <span class="ot">&lt;-</span> species_code</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>Finally we save the <code>df_diagnostic</code> as a csv file using the variables created above.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(df_diagnostic, <span class="at">file =</span> <span class="fu">here</span>(filepath_dfout, <span class="fu">paste0</span>(filename_dfout,<span class="st">".csv"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Remove everything except <code>df_diagnostic</code> ahead of the next step.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>()[<span class="sc">!</span><span class="fu">ls</span>() <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"df_diagnostic"</span>)]) <span class="co">#specify objects to keep</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="filtering-ii" class="level2">
<h2 class="anchored" data-anchor-id="filtering-ii">6. Filtering II</h2>
<p>This second filtering stage is designed to remove outliers in the data, and you can use outputs from the shiny app to inform these choices. If you don’t need to filter for outliers, skip this step and keep using <code>df_diagnostic</code> in the next steps.</p>
<section id="accessing-shiny-app" class="level3">
<h3 class="anchored" data-anchor-id="accessing-shiny-app">Accessing Shiny App</h3>
<section id="option-1" class="level4">
<h4 class="anchored" data-anchor-id="option-1">OPTION 1:</h4>
<p>Access the shiny app online at the following link: <a href="https://lukeozsanlav.shinyapps.io/exmove_explorer/">https://lukeozsanlav.shinyapps.io/exmove_explorer/</a></p>
</section>
<section id="option-2" class="level4">
<h4 class="anchored" data-anchor-id="option-2">OPTION 2:</h4>
<p>Alternatively run the app from your local R session with the following code</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"shiny"</span>)) <span class="fu">install.packages</span>(<span class="st">"shiny"</span>)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(shiny)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="fu">runGitHub</span>(<span class="st">"ExMoveApp"</span>, <span class="at">username =</span> <span class="st">"LukeOzsanlav"</span>,</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">ref =</span> <span class="st">"master"</span>, <span class="at">subdir =</span> <span class="st">"app"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="app-usage" class="level4">
<h4 class="anchored" data-anchor-id="app-usage">App Usage:</h4>
<ul>
<li>Upload your csv version of df_diagnostic to the app by clicking the <code>Upload data</code> button in the top left.</li>
<li>At the bottom of each app page are printed code chunks that can be copied into subsequent user input section. These code chunks contain the user input values you manually select in the app</li>
</ul>
</section>
<section id="define-threshold-values" class="level4">
<h4 class="anchored" data-anchor-id="define-threshold-values">Define threshold values</h4>
<div class="callout-warning callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
🧠 User input required
</div>
</div>
<div class="callout-body-container callout-body">
<p>First we define a period to filter after tag deployment, when all points before the cutoff will be removed (e.g.&nbsp;to remove potentially unnatural behaviour following the tagging event). We define this period using the <code>as.period</code> function, by providing an integer value and time unit (e.g.&nbsp;hours/days/years). This code below specifies a period of 30 minutes:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>filter_cutoff <span class="ot">&lt;-</span> <span class="fu">as.period</span>(<span class="dv">30</span>, <span class="at">unit=</span><span class="st">"minutes"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then we define speed threshold in m/s, which we will use to remove any points with faster speeds.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>filter_speed <span class="ot">&lt;-</span> <span class="dv">20</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next we define a net displacement (distance from first point) threshold and specify units. Any points further away from the first tracking point will be removed:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>filter_netdisp_dist <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>filter_netdist_units <span class="ot">&lt;-</span> <span class="st">"km"</span> <span class="co"># e.g., "m", "km"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<section id="implement-filters" class="level5">
<h5 class="anchored" data-anchor-id="implement-filters">Implement filters</h5>
<p>Create net displacement filter using distance and units</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>filter_netdisp <span class="ot">&lt;-</span> units<span class="sc">::</span><span class="fu">as_units</span>(filter_netdisp_dist, filter_netdist_units)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Filter df_diagnostic</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>df_filtered <span class="ot">&lt;-</span> df_diagnostic <span class="sc">%&gt;%</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Deploydatetime <span class="sc">+</span> filter_cutoff <span class="sc">&lt;</span> DateTime, <span class="co"># keep times after cutoff</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>         speed <span class="sc">&lt;</span> filter_speed, <span class="co"># keep speeds slower than speed filter</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>         netdisp <span class="sc">&lt;</span> filter_netdisp) <span class="co"># keep distances less than net displacement filter</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_filtered)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 22
  ID     Date                Time  Lat   Lon   DateTime            Deplo…¹ CPLat
  &lt;chr&gt;  &lt;dttm&gt;              &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;dttm&gt;                &lt;dbl&gt; &lt;dbl&gt;
1 GV375… 2016-06-25 00:00:00 11:0… -7.2… 72.4… 2016-06-25 11:01:04       1 -7.24
2 GV375… 2016-06-25 00:00:00 11:0… -7.2… 72.4… 2016-06-25 11:08:50       1 -7.24
3 GV375… 2016-06-25 00:00:00 11:1… -7.2… 72.4… 2016-06-25 11:17:13       1 -7.24
4 GV375… 2016-06-25 00:00:00 11:2… -7.2… 72.4… 2016-06-25 11:25:16       1 -7.24
5 GV375… 2016-06-25 00:00:00 11:3… -7.2… 72.4… 2016-06-25 11:30:32       1 -7.24
6 GV375… 2016-06-25 00:00:00 11:3… -7.2… 72.4… 2016-06-25 11:36:43       1 -7.24
# … with 14 more variables: CPLon &lt;dbl&gt;, Species &lt;chr&gt;, Population &lt;chr&gt;,
#   Age &lt;chr&gt;, BreedingStage &lt;chr&gt;, Deploydatetime &lt;dttm&gt;,
#   Retrievedatetime &lt;dttm&gt;, dist [m], difftime &lt;drtn&gt;, netdisp [m],
#   speed &lt;dbl&gt;, turnangle &lt;dbl&gt;, CPdist [m], CPbearing &lt;dbl&gt;, and abbreviated
#   variable name ¹​DeployID</code></pre>
</div>
</div>
<p>Remove intermediate files/objects</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>()[<span class="sc">!</span><span class="fu">ls</span>() <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"df_filtered"</span>)]) <span class="co">#specify objects to keep</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
</section>
<section id="summarise-data" class="level2">
<h2 class="anchored" data-anchor-id="summarise-data">7. Summarise data</h2>
<div class="callout-warning callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
🧠 User input required
</div>
</div>
<div class="callout-body-container callout-body">
<p>Set the units to display sampling rate in the summary table</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>sampleRateUnits <span class="ot">&lt;-</span> <span class="st">"mins"</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="define-levels-of-grouping-factors-to-summarise-over" class="level5">
<h5 class="anchored" data-anchor-id="define-levels-of-grouping-factors-to-summarise-over">Define levels of grouping factors to summarise over</h5>
<p>Firstly, down to population level. Here, we are working on data from one population &amp; year, and so use <code>Species</code> and <code>Population.</code> Add any other relevant grouping factors here (e.g.&nbsp;Country / Year / Season / Age).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>grouping_factors_poplevel <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Species"</span>, <span class="st">"Population"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Secondly, down to individual level (add <code>DeployID</code> for example if relevant).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>grouping_factors_indlevel <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ID"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</div>
</div>
<section id="create-summary-tables" class="level5">
<h5 class="anchored" data-anchor-id="create-summary-tables">Create summary tables</h5>
<p>Create a small function to calculate standard error.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>se <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">sqrt</span>(<span class="fu">var</span>(x, <span class="at">na.rm =</span> T) <span class="sc">/</span> <span class="fu">length</span>(x[<span class="sc">!</span><span class="fu">is.na</span>(x)]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Create a summary table of individual-level summary statistics:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>df_summary_ind <span class="ot">&lt;-</span> df_filtered <span class="sc">%&gt;%</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="fu">across</span>(<span class="fu">c</span>(grouping_factors_poplevel, grouping_factors_indlevel))) <span class="sc">%&gt;%</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">NoPoints =</span> <span class="fu">NROW</span>(ID), <span class="co"># number of fixes</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">NoUniqueDates =</span> <span class="fu">length</span>(<span class="fu">unique</span>(Date)), <span class="co"># number of tracking dates</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">FirstDate =</span> <span class="fu">as.Date</span>(<span class="fu">min</span>(Date)), <span class="co"># first tracking date</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">LastDate =</span> <span class="fu">as.Date</span>(<span class="fu">max</span>(Date)), <span class="co"># last tracking date</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">SampleRate =</span> <span class="fu">mean</span>(<span class="fu">as.numeric</span>(difftime, <span class="at">units =</span> sampleRateUnits), <span class="at">na.rm =</span> T), <span class="co"># sample rate mean</span></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">SampleRate_se =</span> <span class="fu">se</span>(<span class="fu">as.numeric</span>(difftime, <span class="at">units =</span> sampleRateUnits))) <span class="co"># sample rate standard error</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Note: Using an external vector in selections is ambiguous.
ℹ Use `all_of(grouping_factors_poplevel)` instead of `grouping_factors_poplevel` to silence this message.
ℹ See &lt;https://tidyselect.r-lib.org/reference/faq-external-vector.html&gt;.
This message is displayed once per session.
Note: Using an external vector in selections is ambiguous.
ℹ Use `all_of(grouping_factors_indlevel)` instead of `grouping_factors_indlevel` to silence this message.
ℹ See &lt;https://tidyselect.r-lib.org/reference/faq-external-vector.html&gt;.
This message is displayed once per session.
`summarise()` has grouped output by 'Species', 'Population'. You can override using the `.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>df_summary_ind</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 9
# Groups:   Species, Population [2]
  Species Population ID    NoPoi…¹ NoUni…² FirstDate  LastDate   Sampl…³ Sampl…⁴
  &lt;chr&gt;   &lt;chr&gt;      &lt;chr&gt;   &lt;int&gt;   &lt;int&gt; &lt;date&gt;     &lt;date&gt;       &lt;dbl&gt;   &lt;dbl&gt;
1 RFB     DG         GV37…     989       5 2016-06-25 2016-06-29    5.37  0.0270
2 RFB     DG         GV37…    1280       6 2016-06-26 2016-07-01    5.58  0.0789
3 RFB     NI         GV37…     820       4 2018-07-08 2018-07-11    5.18  0.0183
# … with abbreviated variable names ¹​NoPoints, ²​NoUniqueDates, ³​SampleRate,
#   ⁴​SampleRate_se</code></pre>
</div>
</div>
<p>Create a table of population-level summary statistics:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>df_summary_pop <span class="ot">&lt;-</span> df_summary_ind <span class="sc">%&gt;%</span> <span class="co"># use the individual-level summary data</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="fu">across</span>(grouping_factors_poplevel)) <span class="sc">%&gt;%</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">NoInds =</span> <span class="fu">length</span>(<span class="fu">unique</span>(ID)), <span class="co"># number of unique individuals</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">NoPoints_total =</span> <span class="fu">sum</span>(NoPoints), <span class="co"># total number of tracking locations</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">FirstDate =</span> <span class="fu">as.Date</span>(<span class="fu">min</span>(FirstDate)), <span class="co"># first tracking date</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">LastDate =</span> <span class="fu">as.Date</span>(<span class="fu">max</span>(LastDate)), <span class="co"># last tracking date</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">PointsPerBird =</span> <span class="fu">mean</span>(NoPoints), <span class="co"># number of locations per individual: mean</span></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">PointsPerBird_se =</span> <span class="fu">se</span>(NoPoints), <span class="co"># number of locations per individual: standard error</span></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">DatesPerBird =</span> <span class="fu">mean</span>(NoUniqueDates), <span class="co"># number of tracking days per bird: mean</span></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">DatesPerBird_se =</span> <span class="fu">se</span>(NoUniqueDates), <span class="co"># number of tracking days per bird: standard error</span></span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">SampleRate_mean =</span> <span class="fu">mean</span>(SampleRate), <span class="co"># sample rate mean</span></span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">SampleRate_se =</span> <span class="fu">se</span>(SampleRate)) <span class="co"># sample rate standard error</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'Species'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>df_summary_pop</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 12
# Groups:   Species [1]
  Species Populat…¹ NoInds NoPoi…² FirstDate  LastDate   Point…³ Point…⁴ Dates…⁵
  &lt;chr&gt;   &lt;chr&gt;      &lt;int&gt;   &lt;int&gt; &lt;date&gt;     &lt;date&gt;       &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
1 RFB     DG             2    2269 2016-06-25 2016-07-01   1134.    146.     5.5
2 RFB     NI             1     820 2018-07-08 2018-07-11    820      NA      4  
# … with 3 more variables: DatesPerBird_se &lt;dbl&gt;, SampleRate_mean &lt;dbl&gt;,
#   SampleRate_se &lt;dbl&gt;, and abbreviated variable names ¹​Population,
#   ²​NoPoints_total, ³​PointsPerBird, ⁴​PointsPerBird_se, ⁵​DatesPerBird</code></pre>
</div>
</div>
<p>Remove intermediate files/objects by specifying which objects to keep:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>()[<span class="sc">!</span><span class="fu">ls</span>() <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"df_filtered"</span>, <span class="st">"df_summary_ind"</span>, <span class="st">"df_summary_pop"</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="save-filtered-and-summary-data" class="level2">
<h2 class="anchored" data-anchor-id="save-filtered-and-summary-data">8. Save filtered and summary data</h2>
<div class="callout-warning callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
🧠 User input required
</div>
</div>
<div class="callout-body-container callout-body">
<p>First we define a species code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>species_code <span class="ot">&lt;-</span> <span class="st">"RFB"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next we define the folder file path for saving our filtered data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>filepath_filtered_out <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">"DataOutputs"</span>,<span class="st">"WorkingDataFrames"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then we define the file path for saving summary dataframes</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>filepath_summary_out <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">"DataOutputs"</span>,<span class="st">"SummaryDataFrames"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here we define file names for saved files, and paste the species code to <code>_summary_</code>, followed by <code>ind</code> (individual level) or <code>pop</code> (population level). You can change this if you want to use a different naming system.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>filename_filtered_out <span class="ot">&lt;-</span> <span class="fu">paste0</span>(species_code, <span class="st">"_filtered"</span>)</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>filename_summary_ind_out <span class="ot">&lt;-</span> <span class="fu">paste0</span>(species_code, <span class="st">"_summary_ind"</span>)</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>filename_summary_pop_out <span class="ot">&lt;-</span> <span class="fu">paste0</span>(species_code, <span class="st">"_summary_pop"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>Now we can save all our dataframes as .csv files using our defined values</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(df_filtered, <span class="at">file =</span> <span class="fu">here</span>(filepath_filtered_out, <span class="fu">paste0</span>(filename_filtered_out,<span class="st">".csv"</span>)))</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(df_summary_ind, <span class="at">file =</span> <span class="fu">here</span>(filepath_summary_out, <span class="fu">paste0</span>(filename_summary_ind_out,<span class="st">".csv"</span>)))</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(df_summary_pop, <span class="at">file =</span> <span class="fu">here</span>(filepath_summary_out, <span class="fu">paste0</span>(filename_summary_pop_out,<span class="st">".csv"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Lastly we remove intermediate files/objects</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>()[<span class="sc">!</span><span class="fu">ls</span>() <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"df_filtered"</span>, <span class="st">"df_summary_ind"</span>, <span class="st">"df_summary_pop"</span>)]) <span class="co">#specify objects to keep</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="visualisation-i" class="level2">
<h2 class="anchored" data-anchor-id="visualisation-i">9. Visualisation I</h2>
<div class="callout-warning callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
User input required
</div>
</div>
<div class="callout-body-container callout-body">
<p>Define parameters for reading out plots, and define device to read plots out as e.g.&nbsp;tiff/jpeg</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>device <span class="ot">&lt;-</span> <span class="st">"tiff"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Define units for plot size - usually mm</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>units <span class="ot">&lt;-</span> <span class="st">"mm"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Define plot resolution in dpi - 300 usually minimum</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>dpi <span class="ot">&lt;-</span> <span class="dv">300</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Define filepath to read out plots</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>out_path <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">"DataOutputs"</span>,<span class="st">"Figures"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Define species code for figure names</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>species_code <span class="ot">&lt;-</span> <span class="st">"RFB"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We plot maps over a topography base-layer which can include terrestrial (elevation) and marine (bathymetry/water depth) data. To set legend label for topography data, relevant to your data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>topo_label <span class="ot">=</span> <span class="st">"Depth (m)"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>Load additional libraries for spatial visualisation (optional step - could be removed/improved later!!)</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
If you see a <code>masking</code> warning these are fine. Watch out for packages that aren’t installed yet
</div>
</div>
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rnaturalearth)</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(marmap)</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>Version of data for plotting which includes transforming required columns to numeric and creating time elapsed columns</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>df_plotting <span class="ot">&lt;-</span> df_filtered <span class="sc">%&gt;%</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID) <span class="sc">%&gt;%</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diffsecs =</span> <span class="fu">as.numeric</span>(difftime),</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">secs_elapsed =</span> <span class="fu">cumsum</span>(<span class="fu">replace_na</span>(diffsecs, <span class="dv">0</span>)),</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">time_elapsed =</span> <span class="fu">as.duration</span>(secs_elapsed),</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">days_elapsed =</span> <span class="fu">as.numeric</span>(time_elapsed, <span class="st">"days"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(dist,speed,CPdist, Lat, Lon), as.numeric))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Create a map of all points. Set the plot limits as the max and min lat/longs as the tracking data</p>
<p>First set up a basemap to plot over: - Use rnatural earth low res countries basemap - co-ordinates in lat/long to match other spatial data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>countries <span class="ot">&lt;-</span> <span class="fu">ne_countries</span>(<span class="at">scale =</span> <span class="st">"medium"</span>, <span class="at">returnclass =</span> <span class="st">"sf"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Define min and max co-ordinates based on extent of tracking data, for adding bathymetry extracted from NOAA database.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>minlon <span class="ot">&lt;-</span> <span class="fu">min</span>(df_plotting<span class="sc">$</span>Lon)</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>maxlon <span class="ot">&lt;-</span> <span class="fu">max</span>(df_plotting<span class="sc">$</span>Lon)</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>minlat <span class="ot">&lt;-</span> <span class="fu">min</span>(df_plotting<span class="sc">$</span>Lat)</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>maxlat <span class="ot">&lt;-</span> <span class="fu">max</span>(df_plotting<span class="sc">$</span>Lat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Load in bathymetry basemap. Set limits slightly beyond tracking data to make a buffer so no gaps when plotting</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>base_topography_map <span class="ot">&lt;-</span> <span class="fu">getNOAA.bathy</span>(</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">lon1 =</span> minlon <span class="sc">-</span> <span class="fl">0.1</span>, <span class="at">lon2 =</span> maxlon <span class="sc">+</span> <span class="fl">0.1</span>,</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">lat1 =</span> minlat <span class="sc">-</span> <span class="fl">0.1</span>, <span class="at">lat2 =</span> maxlat <span class="sc">+</span> <span class="fl">0.1</span>, </span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">resolution =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fortify bathymetry data for plotting</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>base_topography_fort <span class="ot">=</span> <span class="fu">fortify</span>(base_topography_map)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Create base map with correct extent, topography, country outlines, etc.,</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>map_base <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_raster</span>(<span class="at">data =</span> base_topography_fort, </span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y, <span class="at">fill=</span>z), <span class="at">alpha =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add colour scheme for the fill</span></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option=</span><span class="st">"mako"</span>, <span class="at">name =</span> topo_label) <span class="sc">+</span> </span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add map of countries over the top</span></span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> countries, <span class="fu">aes</span>(<span class="at">geometry =</span> geometry), <span class="at">fill =</span> <span class="cn">NA</span>) <span class="sc">+</span> </span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add central place points</span></span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df_plotting, </span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> CPLon, <span class="at">y =</span> CPLat),</span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> <span class="st">"#FF3300"</span>, </span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span><span class="st">"#FF3300"</span>, </span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">23</span>, </span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># set plot limits</span></span>
<span id="cb93-16"><a href="#cb93-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(minlon, maxlon), </span>
<span id="cb93-17"><a href="#cb93-17" aria-hidden="true" tabindex="-1"></a>           <span class="at">ylim =</span> <span class="fu">c</span>(minlat, maxlat), <span class="at">crs =</span> <span class="dv">4326</span>) <span class="sc">+</span></span>
<span id="cb93-18"><a href="#cb93-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add labels</span></span>
<span id="cb93-19"><a href="#cb93-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Longitude"</span>, <span class="at">y =</span> <span class="st">"Latitude"</span>) <span class="sc">+</span></span>
<span id="cb93-20"><a href="#cb93-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text=</span><span class="fu">element_text</span>(<span class="at">colour=</span><span class="st">"black"</span>),</span>
<span id="cb93-21"><a href="#cb93-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>),</span>
<span id="cb93-22"><a href="#cb93-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">hjust=</span><span class="fl">0.7</span>),</span>
<span id="cb93-23"><a href="#cb93-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">angle=</span><span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.4</span>, <span class="at">size =</span> <span class="dv">15</span>),</span>
<span id="cb93-24"><a href="#cb93-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">hjust=</span><span class="fl">0.7</span>, <span class="at">angle=</span><span class="dv">90</span>, <span class="at">vjust=</span><span class="fl">0.3</span>)) <span class="sc">+</span></span>
<span id="cb93-25"><a href="#cb93-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span>
<span id="cb93-26"><a href="#cb93-26" aria-hidden="true" tabindex="-1"></a>map_base</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="User_guide_files/figure-html/unnamed-chunk-78-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" role="tab" aria-controls="tabset-6-1" aria-selected="true" href="">Population</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" role="tab" aria-controls="tabset-6-2" aria-selected="false" href="">Several individuals</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-3" role="tab" aria-controls="tabset-6-3" aria-selected="false" href="">Many individuals</a></li></ul>
<div class="tab-content">
<div id="tabset-6-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-6-1-tab">
<p>Plot a combined map of all tracking locations:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>map_alllocs <span class="ot">&lt;-</span> map_base <span class="sc">+</span> </span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df_plotting, <span class="co"># add GPS points</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> Lon, <span class="at">y =</span> Lat), </span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="fl">0.8</span>, <span class="at">size =</span> <span class="fl">0.5</span>) </span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>map_alllocs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="User_guide_files/figure-html/unnamed-chunk-79-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-6-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-2-tab">
<p>Plot a map of individual locations, colouring points by speed, and faceting by ID</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>map_individuals <span class="ot">&lt;-</span> map_base <span class="sc">+</span> </span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df_plotting,  <span class="co"># add GPS points and paths between them</span></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> Lon, <span class="at">y =</span> Lat, <span class="at">col =</span> speed), </span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="fl">0.8</span>, <span class="at">size =</span> <span class="fl">0.5</span> ) <span class="sc">+</span></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> df_plotting, <span class="fu">aes</span>(<span class="at">x =</span> Lon, <span class="at">y =</span> Lat, <span class="at">col =</span> speed), </span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha =</span> <span class="fl">0.8</span>, <span class="at">size =</span> <span class="fl">0.5</span> ) <span class="sc">+</span></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># colour birds using scale_colour_gradient2</span></span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_gradient2</span>(<span class="at">name =</span> <span class="st">"Speed"</span>, <span class="at">low =</span> <span class="st">"blue"</span>, <span class="at">mid =</span> <span class="st">"white"</span>, <span class="at">high =</span> <span class="st">"red"</span>, </span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>                         <span class="at">midpoint =</span> (<span class="fu">max</span>(df_plotting<span class="sc">$</span>speed,<span class="at">na.rm=</span><span class="cn">TRUE</span>)<span class="sc">/</span><span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>  <span class="do">##facet for individual</span></span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> ID, <span class="at">ncol =</span> <span class="fu">n_distinct</span>(df_plotting<span class="sc">$</span>ID))</span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a>map_individuals</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="User_guide_files/figure-html/unnamed-chunk-80-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-6-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-3-tab">
<p>In previous plots, we’ve split the population into individual facets. This works fine on the example code, where we only have a few individuals, but if you have more individuals and the facets are too small, you can split the plot onto multiple pages. Use the below code to use <code>facet_wrap_paginate</code> from the <code>ggforce</code> package:</p>
<div class="cell" data-messages="false">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="do">## ** Option ** ##</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggforce)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'ggforce' was built under R version 4.2.2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="do">## save plot as object to later extract number of pages (e.g. 2 per page):</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>map_individuals <span class="ot">&lt;-</span> map_base <span class="sc">+</span></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_point</span>(<span class="at">data =</span> df_plotting, <span class="co"># add GPS points and paths between them</span></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">x =</span> Lon, <span class="at">y =</span> Lat, <span class="at">col =</span> speed), </span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="fl">0.8</span>, <span class="at">size =</span> <span class="fl">0.5</span> ) <span class="sc">+</span></span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_path</span>(<span class="at">data =</span> df_plotting, </span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> Lon, <span class="at">y =</span> Lat, <span class="at">col =</span> speed), </span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="fl">0.8</span>, <span class="at">size =</span> <span class="fl">0.5</span> ) <span class="sc">+</span></span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_colour_gradient2</span>(<span class="at">name =</span> <span class="st">"Speed"</span>, <span class="co"># colour birds using scale_colour_gradient2</span></span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a>                          <span class="at">low =</span> <span class="st">"blue"</span>, </span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a>                          <span class="at">mid =</span> <span class="st">"white"</span>, </span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a>                          <span class="at">high =</span> <span class="st">"red"</span>, </span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a>                          <span class="at">midpoint =</span> (<span class="fu">max</span>(df_plotting<span class="sc">$</span>speed,<span class="at">na.rm=</span><span class="cn">TRUE</span>)<span class="sc">/</span><span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a>   <span class="fu">facet_wrap_paginate</span>(<span class="sc">~</span>ID, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">nrow=</span> <span class="dv">1</span>, <span class="at">page =</span> <span class="dv">1</span>) <span class="co">#facet for individual</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>How many pages of plots?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">n_pages</span>(map_individuals)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2</code></pre>
</div>
</div>
<p>Run through different values of page to show each page in turn</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>map_individuals</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="User_guide_files/figure-html/unnamed-chunk-83-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</div>
<p>Save maps for further use using <code>ggsave</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">plot =</span> map_alllocs, </span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">filename =</span> <span class="fu">paste0</span>(species_code, <span class="st">"_map_all_locs.tiff"</span>),</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">device =</span> device,</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">path =</span> out_path, </span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">units =</span> units, <span class="at">width =</span> <span class="dv">200</span>, <span class="at">height =</span> <span class="dv">175</span>, <span class="at">dpi =</span> dpi,   </span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">plot =</span> map_individuals, </span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">filename =</span> <span class="fu">paste0</span>(species_code, <span class="st">"_map_individuals.tiff"</span>),</span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">device =</span> device,</span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">path =</span> out_path, </span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">units =</span> units, <span class="at">width =</span> <span class="dv">200</span>, <span class="at">height =</span> <span class="dv">175</span>, <span class="at">dpi =</span> dpi,   </span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Create a time series plot of speed, faceted for each individual.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>speed_time_plot <span class="ot">&lt;-</span> df_plotting <span class="sc">%&gt;%</span> <span class="co">#speed over time</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data=</span>., <span class="fu">aes</span>(<span class="at">x=</span>days_elapsed, <span class="at">y=</span>speed, <span class="at">group=</span>ID)) <span class="sc">+</span></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="co">#coord_cartesian(ylim=c(0,25)) +</span></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"time elapsed (days)"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"speed (m/s)"</span>) <span class="sc">+</span></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>ID, <span class="at">nrow=</span> <span class="fu">n_distinct</span>(df_plotting<span class="sc">$</span>ID)) <span class="sc">+</span></span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text=</span><span class="fu">element_text</span>(<span class="at">colour=</span><span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a>speed_time_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="User_guide_files/figure-html/unnamed-chunk-85-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Warnings about <code>non-finite</code> values for speed/step length plots are expected and usually refer to the first location for each individual (i.e.&nbsp;number of non-finite values should be equal to number of individuals)</p>
</div>
</div>
<p>Save plot for further use</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">plot =</span> speed_time_plot, </span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">filename =</span> <span class="fu">paste0</span>(species_code, <span class="st">"_speed_timeseries_plot.tiff"</span>),</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">device =</span> device,</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">path =</span> out_path, </span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">units =</span> units, <span class="at">width =</span> <span class="dv">200</span>, <span class="at">height =</span> <span class="dv">175</span>, <span class="at">dpi =</span> dpi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Create a histogram of point to point speeds (can adjust binwidth and x limits manually)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>speed_hist <span class="ot">&lt;-</span> df_plotting <span class="sc">%&gt;%</span> <span class="co">#speed histogram</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data=</span>., <span class="fu">aes</span>(speed)) <span class="sc">+</span></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth=</span><span class="fl">0.1</span>, <span class="at">alpha=</span><span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">y =</span><span class="fl">0.1</span><span class="sc">*</span>..count..)) <span class="sc">+</span></span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#xlim(-0.1,5) +</span></span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"speed (m/s)"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"count"</span>) <span class="sc">+</span></span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>ID, <span class="at">nrow=</span> <span class="fu">n_distinct</span>(df_plotting<span class="sc">$</span>ID)) <span class="sc">+</span></span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text=</span><span class="fu">element_text</span>(<span class="at">colour=</span><span class="st">"black"</span>))<span class="sc">+</span></span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a>speed_hist</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="User_guide_files/figure-html/unnamed-chunk-87-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Save plot for further use</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">plot =</span> speed_hist, </span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">filename =</span> <span class="fu">paste0</span>(species_code, <span class="st">"_speed_histogram.tiff"</span>),</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">device =</span> device,</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">path =</span> out_path,</span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">units =</span> units, <span class="at">width =</span> <span class="dv">200</span>, <span class="at">height =</span> <span class="dv">175</span>, <span class="at">dpi =</span> dpi,   </span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Create a time series plot of step lengths (faceted for each individual)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>step_time_plot <span class="ot">&lt;-</span> df_plotting <span class="sc">%&gt;%</span> <span class="co">#step length over time</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data=</span>., <span class="fu">aes</span>(<span class="at">x=</span>days_elapsed, <span class="at">y=</span><span class="fu">as.numeric</span>(netdisp), <span class="at">group=</span>ID)) <span class="sc">+</span></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"time elapsed (days)"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Distance from first fix (m)"</span>) <span class="sc">+</span></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>ID, <span class="at">nrow=</span> <span class="fu">n_distinct</span>(df_plotting<span class="sc">$</span>ID)) <span class="sc">+</span></span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text=</span><span class="fu">element_text</span>(<span class="at">colour=</span><span class="st">"black"</span>))<span class="sc">+</span></span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>step_time_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="User_guide_files/figure-html/unnamed-chunk-89-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Save plot for further use</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">plot =</span> step_time_plot, </span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">filename =</span> <span class="fu">paste0</span>(species_code, <span class="st">"_step_time_plot.tiff"</span>),</span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">device =</span> device,</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">path =</span> out_path,</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">units =</span> units, <span class="at">width =</span> <span class="dv">200</span>, <span class="at">height =</span> <span class="dv">175</span>, <span class="at">dpi =</span> dpi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Create a histogram of step lengths (can adjust binwidth and x limits manually)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>step_hist <span class="ot">&lt;-</span> df_plotting <span class="sc">%&gt;%</span> <span class="co">#step histogram</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data=</span>., <span class="fu">aes</span>(<span class="fu">as.numeric</span>(dist))) <span class="sc">+</span></span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth=</span><span class="dv">1</span>, <span class="at">alpha=</span><span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">y =</span><span class="dv">1</span><span class="sc">*</span>..count..)) <span class="sc">+</span></span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>  <span class="do">##xlim(0,500) +</span></span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"step length (m)"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"count"</span>) <span class="sc">+</span></span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>ID, <span class="at">nrow=</span> <span class="fu">n_distinct</span>(df_plotting<span class="sc">$</span>ID))<span class="sc">+</span></span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Save plot for further use</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">plot =</span> step_hist, </span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">filename =</span> <span class="fu">paste0</span>(species_code, <span class="st">"_step_hist.tiff"</span>),</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">device =</span> device,</span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">path =</span> out_path,</span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">units =</span> units, <span class="at">width =</span> <span class="dv">200</span>, <span class="at">height =</span> <span class="dv">175</span>, <span class="at">dpi =</span> dpi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
    var links = window.document.querySelectorAll('a:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
      }
    }
});
</script>
</div> <!-- /content -->



</body></html>