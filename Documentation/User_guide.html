<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Alice Trevail">
<meta name="author" content="Stephen Lang">
<meta name="author" content="Luke Ozsanlav-Harris">
<meta name="author" content="Liam Langley">
<title>ExMove user guide</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<script src="User_guide_files/libs/clipboard/clipboard.min.js"></script>
<script src="User_guide_files/libs/quarto-html/quarto.js"></script>
<script src="User_guide_files/libs/quarto-html/popper.min.js"></script>
<script src="User_guide_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="User_guide_files/libs/quarto-html/anchor.min.js"></script>
<link href="User_guide_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="User_guide_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="User_guide_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="User_guide_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="User_guide_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script src="User_guide_files/libs/quarto-diagram/mermaid.min.js"></script><script src="User_guide_files/libs/quarto-diagram/mermaid-init.js"></script><link href="User_guide_files/libs/quarto-diagram/mermaid.css" rel="stylesheet">
<link href="User_guide_files/libs/tabwid-1.1.2/tabwid.css" rel="stylesheet">
</head>
<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-full">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#pre-flight-checks" id="toc-pre-flight-checks" class="nav-link" data-scroll-target="#pre-flight-checks">0. Pre-flight checks</a></li>
  <li><a href="#read-in-data-files" id="toc-read-in-data-files" class="nav-link" data-scroll-target="#read-in-data-files">1. Read in data files</a></li>
  <li><a href="#merge-with-metadata" id="toc-merge-with-metadata" class="nav-link" data-scroll-target="#merge-with-metadata">2. Merge with metadata</a></li>
  <li><a href="#cleaning" id="toc-cleaning" class="nav-link" data-scroll-target="#cleaning">3. Cleaning</a></li>
  <li><a href="#processing" id="toc-processing" class="nav-link" data-scroll-target="#processing">4. Processing</a></li>
  <li><a href="#save-for-shiny" id="toc-save-for-shiny" class="nav-link" data-scroll-target="#save-for-shiny">5. Save for Shiny</a></li>
  <li>
<a href="#filtering" id="toc-filtering" class="nav-link" data-scroll-target="#filtering">6. Filtering</a>
  <ul class="collapse">
<li><a href="#shiny-app" id="toc-shiny-app" class="nav-link" data-scroll-target="#shiny-app">Accessing the Shiny app</a></li>
  </ul>
</li>
  <li><a href="#summarise-data" id="toc-summarise-data" class="nav-link" data-scroll-target="#summarise-data">7. Summarise cleaned &amp; filtered tracking data</a></li>
  <li><a href="#save-data" id="toc-save-data" class="nav-link" data-scroll-target="#save-data">8. Save filtered and summary data</a></li>
  <li><a href="#visualisation-i" id="toc-visualisation-i" class="nav-link" data-scroll-target="#visualisation-i">9. Visualisation I</a></li>
  </ul></nav>
</div>
<main class="content column-page-left" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">ExMove user guide</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source" data-quarto-source-url="https://github.com/ExMove/ExMove/blob/main/R/Workflow.R"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Authors</div>
    <div class="quarto-title-meta-contents">
             <p>Alice Trevail <a href="https://orcid.org/0000-0002-6459-5213" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
             <p>Stephen Lang <a href="https://orcid.org/0000-0001-5820-4346" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
             <p>Luke Ozsanlav-Harris <a href="https://orcid.org/0000-0003-3889-6722" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
             <p>Liam Langley <a href="https://orcid.org/0000-0001-9754-6517" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
          </div>
  </div>
    
  
    
  </div>
  

</header><section id="introduction" class="level2"><h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>This user guide can be used as a walkthrough for reading and processing tracking data files with the <code>Workflow.R</code> script. You can use the example datasets provided in <code>Data</code>, or try with your own tracking data (see <a href="#pre-flight-checks">Pre-flight checks</a> for details on data requirements and structure).</p>
<p>The following diagram gives an overview of the workflow (boxes link to each section):</p>
<div class="cell" data-fig-label="fig-1" data-fig-width="9" data-eval="true">
<div class="cell-output-display">
<div>
<p>
</p>
<pre class="mermaid mermaid-js" data-tooltip-selector="#mermaid-tooltip-1">%%{init:{'flowchart':{'nodeSpacing': 5, 'rankSpacing': 30}}}%%
flowchart LR
subgraph ALL [" "]
style ALL fill:none,stroke:none
  S1[Read in data] ==&gt; S3{Merge}
  S2[Read in metadata] ==&gt; S3 ==&gt; A(Clean) ==&gt; B(Process) ==&gt; C(Save) 
  A --&gt; A1((Shiny app)) --&gt; B
  B ---&gt;|"&lt;br/&gt; Summarise/&lt;br/&gt;Visualise"|C
  B --&gt; B1((Shiny app)) --&gt; C
  end
  C --&gt; D
  C --&gt; C1((Shiny app))
  C ==&gt; S{Analyses}
  subgraph OPTIONAL ["OPTIONAL"]
    style OPTIONAL fill:#fbfbfb, stroke:#999, stroke-width:px, stroke-dasharray:5 5
    D(Filter) --&gt; E(Save)
    C1 --&gt; D
    D ---&gt;|"&lt;br/&gt; Summarise/&lt;br/&gt;Visualise"|E
    end
    E --&gt; S
    linkStyle 0,1,2,3,4,12 stroke-width:5px %% stroke:#00dca5 (this bit is how you edit colours of lines — no way to change colour of arrow heads)
%% NOTE: remember to update links for finalised user guide!!
  click S1 "#read-in-data-files";
  click S2 "#merge-with-metadata";
  click S3 "#merge-with-metadata";
  click A "#cleaning";
  click B "#processing";
  click C "#save-for-shiny";
  click D "#filtering";
  click E "#save-data";
  click A1 "#shiny-app"
  click B1 "#shiny-app"
  click C1 "#shiny-app"
%%  click ? "#summarise-data";
%%  click ? "#visualisation-i";
</pre>
<div id="mermaid-tooltip-1" class="mermaidTooltip">

</div>

<p>Figure 1: Diagram of workflow used for analysing movement data (thick line denotes core path of workflow)</p>
</div>
</div>
</div>
<section id="dependencies" class="level4"><h4 class="anchored" data-anchor-id="dependencies">Dependencies:</h4>
<ul>
<li>This workflow uses the <a href="https://www.r-project.org/about.html">R programming language</a>, run via the <a href="https://www.rstudio.com/products/rstudio/">R Studio IDE</a>
</li>
<li>All code embraces the core principles of how to structure <a href="https://r4ds.had.co.nz/tidy-data.html">‘tidy data’</a>
</li>
<li>We use <a href="https://r4ds.had.co.nz/workflow-projects.html#rstudio-projects">RStudio projects</a> and the <a href="https://here.r-lib.org/"><code>here</code></a> package to build relative filepaths that are reproducible</li>
<li>Requires <a href="https://www.tidyverse.org/"><code>tidyverse</code></a>, <a href="https://github.com/Rdatatable/data.table"><code>data.table</code></a>, <a href="https://r-spatial.github.io/sf/"><code>sf</code></a> and <a href="https://here.r-lib.org/"><code>here</code></a> packages to be installed</li>
<li>Use our example data sets in the Data folder (RFB_IMM, RFB, GWFG, TRPE) or provide your own data</li>
</ul></section><section id="user-inputs" class="level4"><h4 class="anchored" data-anchor-id="user-inputs">User inputs</h4>
<p>Some code chunks require editing by the user to match the specific dataset being used (particularly if you are using your own data), and are highlighted as below (the 🧠 indicates you will need to think about the structure and format of your data when making these edits!):</p>
<div class="callout-warning callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
🧠 User input required
</div>
</div>
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#--------------------#</span></span>
<span><span class="co">## USER INPUT START ##</span></span>
<span><span class="co">#--------------------#</span></span>
<span><span class="va">example_input</span> <span class="op">&lt;-</span> <span class="st">"uservalue"</span> <span class="co"># In the R code, user input sections appear like this</span></span>
<span><span class="co">#------------------#</span></span>
<span><span class="co">## USER INPUT END ##</span></span>
<span><span class="co">#------------------#</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section></section><section id="pre-flight-checks" class="level2"><h2 class="anchored" data-anchor-id="pre-flight-checks">0. Pre-flight checks</h2>
<section id="how-to-use-this-workflow" class="level5"><h5 class="anchored" data-anchor-id="how-to-use-this-workflow">How to use this workflow:</h5>
<ul>
<li>We will inspect the data before reading it in, so there is no need to open it in another program (e.g., excel, which can corrupt dates and times)</li>
<li>User-defined parameters (see <a href="#user-inputs">user inputs</a>) are called within the subsequent processing steps</li>
<li>Where you see: <code>## ** Option ** ##</code>, there is an alternative version of the code to fit some common alternative data formats</li>
<li>Throughout, we will use some key functions to inspect the data (e.g., <code>head</code> for top rows, <code>str</code> for column types, and <code>names</code> for column names)</li>
</ul></section><section id="required-data-structure" class="level5"><h5 class="anchored" data-anchor-id="required-data-structure">Required data structure:</h5>
<ul>
<li>Data files should all be stored in a specific place — ideally within the <code>Data</code> folder</li>
<li>Tracking data must contain a timestamp and at least one other sensor column</li>
<li>Data for each deployment/individual should be in a separate file</li>
<li>ID should be in tracking data file name, and should be the same length for all individuals</li>
<li>Metadata file should be in parent directory of data files</li>
<li>Metadata should contain one row per individual per deployment</li>
</ul></section><section id="the-importance-of-id" class="level5"><h5 class="anchored" data-anchor-id="the-importance-of-id">The importance of ID:</h5>
<ul>
<li>Throughout this workflow, we use ID to refer to the unique code for an individual animal</li>
<li>In certain cases, you might have additional ID columns in the metadata (e.g., <code>DeployID</code>),</li>
<li>or read in data with a unique TagID instead of ID.</li>
<li>This code will work as long as all of the relevant info is included in the metadata</li>
<li>For more info and helpful code, see the FAQ document &amp; troubleshooting script</li>
</ul></section><section id="how-to-troubleshoot-problems-if-something-doesnt-work-with-your-data" class="level5"><h5 class="anchored" data-anchor-id="how-to-troubleshoot-problems-if-something-doesnt-work-with-your-data">How to troubleshoot problems if something doesn’t work with your data:</h5>
<ul>
<li>Refer to the FAQ document in the GitHub page</li>
<li>This signposts to helpful resources online (e.g., spatial co-ordinate systems)</li>
<li>See the troubleshooting code scripts that we’ve written to accompany this workflow (e.g., using multiple ID columns for re-deployments of tags/individuals)</li>
<li>All functions in code chunks are automatically hyperlinked to their documentation, so feel free to explore this if you want to understand more about how this code works!</li>
</ul></section><section id="load-required-libraries" class="level5"><h5 class="anchored" data-anchor-id="load-required-libraries">Load required libraries</h5>
<p>Just before starting we load in all the packages we will need for the workflow (also referenced in the <a href="#dependencies">Dependencies</a> section).</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com">data.table</a></span><span class="op">)</span> <span class="co"># data manipulation</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span> <span class="co"># data manipulation, date time parsing and plotting</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org">lubridate</a></span><span class="op">)</span> <span class="co"># this should be loaded in tidyverse, but adding just in case</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span> <span class="co"># spatial data handling and manipulation</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/">here</a></span><span class="op">)</span> <span class="co"># reproducible filepaths</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="read-in-data-files" class="level2"><h2 class="anchored" data-anchor-id="read-in-data-files">1. Read in data files</h2>
<div class="callout-warning callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
🧠 User input required
</div>
</div>
<div class="callout-body-container callout-body">
<p>Throughout the script, we’ll be saving files using a species code as a file/folder identifier. Let’s define this object here for consistency:</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">species_code</span> <span class="op">&lt;-</span> <span class="st">"RFB_IMM"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Set filepath for the folder containing raw data files (this code will try to list and open all files matching the file pattern within this folder, so it is best if this folder contains only the raw data files).</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">filepath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"Data"</span>, <span class="st">"RFB_IMM"</span><span class="op">)</span>  <span class="co">#create relative filepath using folder names</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Define common file pattern to look for. An asterisk (<code>*</code>) is the wildcard, will will match any character except a forward-slash (e.g.&nbsp;<code>*.csv</code> will import all files that end with “.csv”).</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">filepattern</span> <span class="op">&lt;-</span> <span class="st">"*.txt"</span> <span class="co"># data file format (e.g. we'd use "*.csv" to import all csv files within filepath folders)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s view the file names, to check that we have the files we want &amp; find ID position (this list will include names of sub-folders).</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ls_filenames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">filepath</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span>, pattern <span class="op">=</span> <span class="va">filepattern</span><span class="op">)</span></span>
<span><span class="va">ls_filenames</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "229275/229275a.txt" "229276/229276a.txt"</code></pre>
</div>
</div>
<p>Adjust these numbers for extracting the ID number from file name using <a href="https://stringr.tidyverse.org/index.html"><code>stringr</code></a> (e.g.&nbsp;to extract <code>GV37501</code> from “GV37501_201606_DG_RFB.csv”, we want characters 1-7).  <strong>NB:</strong> this approach only works if all ID’s are the same length and in the same position — see the <a href="https://stringr.tidyverse.org/reference/str_sub.html"><code>str_sub</code></a> documentation for other options.</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">IDstart</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="co">#start position of the ID in the filename </span></span>
<span><span class="va">IDend</span> <span class="op">&lt;-</span> <span class="fl">6</span> <span class="co">#end position of the ID in the filename</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, let’s inspect the data by reading in the top of the first data file as raw text. To inspect the first row of all data files (if you wanted to check column names), you can remove the <code>[1]</code> and change <code>n_max = 1</code>).</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">test</span> <span class="op">&lt;-</span> <span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/dir_ls.html">dir_ls</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">filepath</span>, recurse <span class="op">=</span> <span class="cn">TRUE</span>, type <span class="op">=</span> <span class="st">"file"</span>,  glob <span class="op">=</span> <span class="va">filepattern</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_lines.html">read_lines</a></span><span class="op">(</span><span class="va">test</span>, n_max <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>  <span class="co"># change n_max to change the number of rows to read in</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Date Time\tFix\tLat1(N)\tLong1(E)\tLat2(N)\tLong2(E)\tMsgCount\tFrequency\tAverage TI\tSatellite\tMax Str\tSwapped"
[2] "2022-02-07 12:51:16\tZ\t 63.903\t -61.318\t 63.903\t -61.318\t  4\t697187.5\t130.0\t1\t-121\t"                     
[3] "2022-02-07 12:55:50\t3\t -7.259\t  72.358\t -7.818\t  74.874\t  5\t671259.7\t 65.0\tR\t-123\t1"                    
[4] "2022-02-08 04:09:32\tA\t -7.259\t  72.370\t -7.259\t  72.370\t  3\t671174.9\t 67.7\tC\t-125\t"                     
[5] "2022-02-08 04:48:48\tB\t -7.237\t  72.371\t -7.237\t  72.371\t  2\t671139.5\t139.0\tN\t-133\t"                     </code></pre>
</div>
</div>
<p>Define number of lines at top of file to skip (e.g.&nbsp;if importing a text file with additional info at top).</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">skiplines</span> <span class="op">&lt;-</span> <span class="fl">0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Define date format(s) used (for passing to <a href="https://lubridate.tidyverse.org/reference/lubridate-package.html"><code>lubridate</code></a>) (<code>d</code> = day as decimal, <code>m</code> = month as decimal, <code>y</code> = year without century - 2 digits, <code>Y</code> = year with century - 4 digits). <code>lubridate</code> can even parse more than one date/time format within a dataframe, so if your data include multiple formats, make sure they are all included. Here, we’ve included some common combinations — modify if your data include a different format</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">date_formats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"dmY"</span>, <span class="st">"Ymd"</span><span class="op">)</span> <span class="co">#specify date formats (e.g. "dmY" works for 01-12-2022 and 01/12/2022)</span></span>
<span><span class="va">datetime_formats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"dmY HMS"</span>, <span class="st">"Ymd HMS"</span><span class="op">)</span> <span class="co">#specify date &amp; time format </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Define time zone for tracking data.</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">trackingdatatimezone</span> <span class="op">&lt;-</span> <span class="st">"GMT"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>By default, the below code will find column names from the first row of data. If you want to specify your own column names, do so here as a character vector, or use <code>set colnames &lt;- FALSE</code> to automatically number columns.</p>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">colnames</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here, we use the function <code>read_delim</code> and specify the delimiter to make this code more universal (you can find extra information on this in the <a href="https://readr.tidyverse.org/reference/read_delim.html"><code>readr</code> documentation</a>).</p>
<p>Some delimiter examples:</p>
<ul>
<li>
<code>","</code> = comma delimited (equivalent to using <code>read_csv</code> – saved as extension <code>.csv</code>)</li>
<li>
<code>"\t"</code> = tab delimited (equivalent to using <code>read_tsv</code> — saved as extension <code>.tsv</code>)</li>
<li>
<code>" "</code> = whitespace delimited (equivalent to using <code>read_table</code>)</li>
</ul>
<p>Let’s inspect the data again, this time skipping rows if set, to check the file delimiter.</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_lines.html">read_lines</a></span><span class="op">(</span><span class="va">test</span>, n_max <span class="op">=</span> <span class="fl">5</span>, skip <span class="op">=</span> <span class="va">skiplines</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Date Time\tFix\tLat1(N)\tLong1(E)\tLat2(N)\tLong2(E)\tMsgCount\tFrequency\tAverage TI\tSatellite\tMax Str\tSwapped"
[2] "2022-02-07 12:51:16\tZ\t 63.903\t -61.318\t 63.903\t -61.318\t  4\t697187.5\t130.0\t1\t-121\t"                     
[3] "2022-02-07 12:55:50\t3\t -7.259\t  72.358\t -7.818\t  74.874\t  5\t671259.7\t 65.0\tR\t-123\t1"                    
[4] "2022-02-08 04:09:32\tA\t -7.259\t  72.370\t -7.259\t  72.370\t  3\t671174.9\t 67.7\tC\t-125\t"                     
[5] "2022-02-08 04:48:48\tB\t -7.237\t  72.371\t -7.237\t  72.371\t  2\t671139.5\t139.0\tN\t-133\t"                     </code></pre>
</div>
</div>
<p>Set delimiter to use within <code>read_delim</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">user_delim</span> <span class="op">&lt;-</span> <span class="st">"\t"</span></span>
<span><span class="va">user_trim_ws</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span> <span class="co"># Should leading/trailing whitespaces be trimmed from each field before parsing?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, data need an ID column, either be the tag ID (“TagID”) or individual ID (“ID”). Specify ID type here, for later matching with the same column in the metadata:</p>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ID_type</span> <span class="op">&lt;-</span> <span class="st">"TagID"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<section id="read-in-and-merge-all-tracking-data-files" class="level4 tabset"><h4 class="tabset anchored" data-anchor-id="read-in-and-merge-all-tracking-data-files">Read in and merge all tracking data files</h4>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" href="">Merge using ID in filename</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false" href="">Option: Merge using ID already in column</a></li>
</ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p>With the user inputs specified in the previous section, we’ll now read in and merge all tracking data files directly from the github repository, extracting the ID from the filename of each file.</p>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df_combined</span> <span class="op">&lt;-</span> <span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/dir_ls.html">dir_ls</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">filepath</span>, glob <span class="op">=</span> <span class="va">filepattern</span>, <span class="co">#use our defined filepath and pattern</span></span>
<span>                          type <span class="op">=</span> <span class="st">"file"</span>,  recurse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># recurse = T searches all sub-folders</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/set_names.html">set_names</a></span><span class="op">(</span>nm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/basename.html">basename</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># removing path prefix (makes filename more manageable)</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html">map_dfr</a></span><span class="op">(</span><span class="va">read_delim</span>, .id<span class="op">=</span><span class="st">"filename"</span>, <span class="co">#read all the files in using filename as ID column</span></span>
<span>                 col_types <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/cols.html">cols</a></span><span class="op">(</span>.default <span class="op">=</span> <span class="st">"c"</span><span class="op">)</span>, col_names <span class="op">=</span> <span class="va">colnames</span>, </span>
<span>                 skip <span class="op">=</span> <span class="va">skiplines</span>, delim <span class="op">=</span> <span class="va">user_delim</span>, trim_ws <span class="op">=</span> <span class="va">user_trim_ws</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="st">"{ID_type}"</span> <span class="op">:=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html">str_sub</a></span><span class="op">(</span>string <span class="op">=</span> <span class="va">filename</span>, start <span class="op">=</span> <span class="va">IDstart</span>, end <span class="op">=</span> <span class="va">IDend</span><span class="op">)</span>, <span class="co">#substring ID from the filename (start to end of substring)</span></span>
<span>         .after <span class="op">=</span> <span class="va">filename</span><span class="op">)</span> <span class="co">#position the new ID column after filename column</span></span>
<span><span class="va">df_combined</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 326 × 14
   filename  TagID Date …¹ Fix   Lat1(…² Long1…³ Lat2(…⁴ Long2…⁵ MsgCo…⁶ Frequ…⁷
   &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  
 1 229275a.… 2292… 2022-0… Z     63.903  -61.318 63.903  -61.318 4       697187…
 2 229275a.… 2292… 2022-0… 3     -7.259  72.358  -7.818  74.874  5       671259…
 3 229275a.… 2292… 2022-0… A     -7.259  72.370  -7.259  72.370  3       671174…
 4 229275a.… 2292… 2022-0… B     -7.237  72.371  -7.237  72.371  2       671139…
 5 229275a.… 2292… 2022-0… B     -7.142  72.471  -7.142  72.471  1       671257…
 6 229275a.… 2292… 2022-0… B     -7.144  72.486  -7.144  72.486  2       671155…
 7 229275a.… 2292… 2022-0… B     -7.140  72.492  -7.140  72.492  1       671120…
 8 229275a.… 2292… 2022-0… B     -7.343  72.432  -7.343  72.432  2       671136…
 9 229275a.… 2292… 2022-0… B     -7.325  72.421  -7.325  72.421  1       671127…
10 229275a.… 2292… 2022-0… A     -7.255  72.470  -7.255  72.470  3       671237…
# … with 316 more rows, 4 more variables: `Average TI` &lt;chr&gt;, Satellite &lt;chr&gt;,
#   `Max Str` &lt;chr&gt;, Swapped &lt;chr&gt;, and abbreviated variable names
#   ¹​`Date Time`, ²​`Lat1(N)`, ³​`Long1(E)`, ⁴​`Lat2(N)`, ⁵​`Long2(E)`, ⁶​MsgCount,
#   ⁷​Frequency</code></pre>
</div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">df_combined</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "filename"   "TagID"      "Date Time"  "Fix"        "Lat1(N)"   
 [6] "Long1(E)"   "Lat2(N)"    "Long2(E)"   "MsgCount"   "Frequency" 
[11] "Average TI" "Satellite"  "Max Str"    "Swapped"   </code></pre>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p>If your data are combined into one or multiple csv files containing an ID column, use the following approach instead (this is the same code, but doesn’t create a new ID column from the file name):</p>
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># ** Option **</span></span>
<span><span class="va">df_combined</span> <span class="op">&lt;-</span> <span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/dir_ls.html">dir_ls</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">filepath</span>, recurse <span class="op">=</span> <span class="cn">TRUE</span>, type <span class="op">=</span> <span class="st">"file"</span>,  glob <span class="op">=</span> <span class="va">filepattern</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># recurse = T searches all sub-folders</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html">map_dfr</a></span><span class="op">(</span><span class="va">read_delim</span>, col_types <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/cols.html">cols</a></span><span class="op">(</span>.default <span class="op">=</span> <span class="st">"c"</span><span class="op">)</span>, col_names <span class="op">=</span> <span class="va">colnames</span>, </span>
<span>                 skip <span class="op">=</span> <span class="va">skiplines</span>, delim <span class="op">=</span> <span class="va">user_delim</span>, trim_ws <span class="op">=</span> <span class="va">user_trim_ws</span><span class="op">)</span> </span>
<span><span class="va">df_combined</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section><section id="slim-down-dataset" class="level4 tabset"><h4 class="tabset anchored" data-anchor-id="slim-down-dataset">Slim down dataset</h4>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true" href="">Select normal columns</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false" href="">Option: Select custom columns</a></li>
</ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="callout-warning callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
🧠 User input required
</div>
</div>
<div class="callout-body-container callout-body">
<p>First, data need a time stamp, either in separate columns (e.g., “Date” and “Time”) or combined (“DateTime”). Below we specify which column’s date and time info are stored in the data.  <strong>NB:</strong> These have to be in the same order as specified in earlier user input, i.e.&nbsp;“Date” and “Time” have to be the right way round</p>
<div class="cell">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">datetime_formats</span> <span class="co"># a reminder of the datetime orders previously specified</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "dmY HMS" "Ymd HMS"</code></pre>
</div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">datetime_colnames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"DateTime"</span><span class="op">)</span> <span class="co"># or c("Date", "Time")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can also have additional columns depending on the type of logger used, for example:</p>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## lc = Argos fix quality</span></span>
<span><span class="co">## Lat2/Lon2 = additional location fixes from Argos tag</span></span>
<span><span class="co">## laterr/lonerr = location error information provided by some GLS processing packages</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here we’re going to slim down the dataset by selecting the necessary columns &amp; coercing some column names. You should change column names below to those present in your tracking data, additional columns can be added (see above examples). This process standardises important column names for the rest of the workflow (e.g., <code>TagID</code>, <code>Lat</code>, <code>Lon</code>)</p>
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df_slim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>TagID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">df_combined</span><span class="op">$</span><span class="va">TagID</span><span class="op">)</span>,</span>
<span>                      DateTime <span class="op">=</span> <span class="va">df_combined</span><span class="op">$</span><span class="va">`Date Time`</span>,</span>
<span>                      lc <span class="op">=</span> <span class="va">df_combined</span><span class="op">$</span><span class="va">Fix</span>, <span class="co"># Argos fix quality</span></span>
<span>                      Lat <span class="op">=</span> <span class="va">df_combined</span><span class="op">$</span><span class="va">`Lat1(N)`</span>,</span>
<span>                      Lon <span class="op">=</span> <span class="va">df_combined</span><span class="op">$</span><span class="va">`Long1(E)`</span>,</span>
<span>                      Lat2 <span class="op">=</span> <span class="va">df_combined</span><span class="op">$</span><span class="va">`Lat2(N)`</span>,</span>
<span>                      Lon2 <span class="op">=</span> <span class="va">df_combined</span><span class="op">$</span><span class="va">`Long2(E)`</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="callout-warning callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
🧠 User input required
</div>
</div>
<div class="callout-body-container callout-body">
<p>Here’s an example of how to change the above code for data with different columns and column names. This code works with immersion data recorded by a GLS logger (no location data)</p>
<div class="cell">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df_slim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>ID <span class="op">=</span> <span class="va">df_combined</span><span class="op">$</span><span class="va">ID</span>,</span>
<span>                      Date <span class="op">=</span> <span class="va">df_combined</span><span class="op">$</span><span class="va">`DD/MM/YYYY`</span>,</span>
<span>                      Time <span class="op">=</span> <span class="va">df_combined</span><span class="op">$</span><span class="va">`HH:MM:SS`</span>,</span>
<span>                      Immersion <span class="op">=</span> <span class="va">df_combined</span><span class="op">$</span><span class="va">`wets0-20`</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
</section><section id="parse-dates-create-datetime-date-and-year-columns" class="level4"><h4 class="anchored" data-anchor-id="parse-dates-create-datetime-date-and-year-columns">Parse dates, create datetime, date and year columns</h4>
<p>Now our <code>df_slim</code> is ready, we need to create a <code>DateTime</code> column. Using the <code>datetime_colnames</code> object we made previously, we’ll combine columns (if needed), and then parse a single <code>DateTime</code> column using the <code>lubridate</code> package:</p>
<div class="cell">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df_slim</span> <span class="op">&lt;-</span> <span class="va">df_slim</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/unite.html">unite</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"DateTime_unparsed"</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">all_of</a></span><span class="op">(</span><span class="va">datetime_colnames</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">" "</span>, remove <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>DateTime <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/parse_date_time.html">parse_date_time</a></span><span class="op">(</span><span class="va">DateTime_unparsed</span>, <span class="co">#use lubridate to parse DateTime </span></span>
<span>                                               orders<span class="op">=</span><span class="va">datetime_formats</span>, <span class="co">#using the datetime_formats object we made earlier</span></span>
<span>                                               tz<span class="op">=</span><span class="va">trackingdatatimezone</span><span class="op">)</span>,</span>
<span>         Date <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/as_date.html">as_date</a></span><span class="op">(</span><span class="va">DateTime</span><span class="op">)</span>,</span>
<span>         Year <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/IDateTime.html">year</a></span><span class="op">(</span><span class="va">DateTime</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">DateTime_unparsed</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you see any <code>failed to parse</code> warnings, this means a date or time was not in the correct format for <code>lubridate</code> to create a date_time object, producing NA’s (which will be dealt with later). We can look at the failing rows using the following code:</p>
<div class="cell">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Fails</span> <span class="op">&lt;-</span> <span class="va">df_slim</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">DateTime</span><span class="op">)</span><span class="op">==</span><span class="cn">T</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">Fails</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TagID    DateTime lc       Lat      Lon      Lat2     Lon2     Date    
[9] Year    
&lt;0 rows&gt; (or 0-length row.names)</code></pre>
</div>
</div>
</div>
</div>
<p>Lastly, we make a <code>df_raw</code> dataframe by sorting using ID and DateTime, dropping NA’s in DateTime column</p>
<div class="cell">
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df_raw</span> <span class="op">&lt;-</span> <span class="va">df_slim</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">all_of</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">ID_type</span>, <span class="st">"DateTime"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">DateTime</span><span class="op">)</span> <span class="co">#remove NA's in datetime column</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">df_raw</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   TagID            DateTime lc    Lat     Lon   Lat2    Lon2       Date Year
1 229275 2022-02-07 12:51:16  Z 63.903 -61.318 63.903 -61.318 2022-02-07 2022
2 229275 2022-02-07 12:55:50  3 -7.259  72.358 -7.818  74.874 2022-02-07 2022
3 229275 2022-02-08 04:09:32  A -7.259  72.370 -7.259  72.370 2022-02-08 2022
4 229275 2022-02-08 04:48:48  B -7.237  72.371 -7.237  72.371 2022-02-08 2022
5 229275 2022-02-08 04:58:02  B -7.142  72.471 -7.142  72.471 2022-02-08 2022
6 229275 2022-02-08 05:49:35  B -7.144  72.486 -7.144  72.486 2022-02-08 2022</code></pre>
</div>
</div>
<p>We can clean up intermediate files/objects by listing everything we want to keep (i.e.&nbsp;remove everything else)</p>
<div class="cell">
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"df_raw"</span>,</span>
<span>                          <span class="st">"date_formats"</span>,<span class="st">"datetime_formats"</span>,<span class="st">"trackingdatatimezone"</span>, </span>
<span>                          <span class="st">"ID_type"</span>, <span class="st">"species_code"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="merge-with-metadata" class="level2"><h2 class="anchored" data-anchor-id="merge-with-metadata">2. Merge with metadata</h2>
<p>Metadata are an essential piece of information for any tracking study, as they contain important information about each of your data files, such as tag ID, animal ID, or deployment information, that we can add back into to our raw data when needed. For example, the table below shows what the first few columns of a metadata file looks like for our example immature red-footed booby data:</p>
<div class="cell">
<div class="cell-output-display">

<div class="tabwid">
<style>.cl-7a93a0b2{}.cl-7a90826a{font-family:'Helvetica';font-size:11pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-7a908274{font-family:'Helvetica';font-size:10.5pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-7a91c12a{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-7a91ca1c{width:0.931in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-7a91ca26{width:1.015in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-7a91ca27{width:1.236in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-7a91ca28{width:0.973in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-7a91ca30{width:0.922in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-7a91ca31{width:1.474in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-7a91ca32{width:0.795in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-7a91ca33{width:1.032in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-7a91ca34{width:0.931in;background-color:transparent;vertical-align: middle;border-bottom: 0.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-7a91ca3a{width:1.015in;background-color:transparent;vertical-align: middle;border-bottom: 0.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-7a91ca3b{width:1.236in;background-color:transparent;vertical-align: middle;border-bottom: 0.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-7a91ca3c{width:0.973in;background-color:transparent;vertical-align: middle;border-bottom: 0.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-7a91ca3d{width:0.922in;background-color:transparent;vertical-align: middle;border-bottom: 0.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-7a91ca44{width:1.474in;background-color:transparent;vertical-align: middle;border-bottom: 0.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-7a91ca45{width:0.795in;background-color:transparent;vertical-align: middle;border-bottom: 0.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-7a91ca46{width:1.032in;background-color:transparent;vertical-align: middle;border-bottom: 0.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-7a91ca47{width:0.931in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-7a91ca4e{width:1.015in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-7a91ca4f{width:1.236in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-7a91ca50{width:0.973in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-7a91ca51{width:0.922in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-7a91ca58{width:1.474in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-7a91ca59{width:0.795in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-7a91ca5a{width:1.032in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style>
<table class="cl-7a93a0b2">
<thead><tr style="overflow-wrap:break-word;">
<th class="cl-7a91ca1c"><p class="cl-7a91c12a"><span class="cl-7a90826a">bird_id</span></p></th>
<th class="cl-7a91ca26"><p class="cl-7a91c12a"><span class="cl-7a90826a">gps_tag</span></p></th>
<th class="cl-7a91ca27"><p class="cl-7a91c12a"><span class="cl-7a90826a">capture_date</span></p></th>
<th class="cl-7a91ca27"><p class="cl-7a91c12a"><span class="cl-7a90826a">capture_time</span></p></th>
<th class="cl-7a91ca28"><p class="cl-7a91c12a"><span class="cl-7a90826a">lat</span></p></th>
<th class="cl-7a91ca30"><p class="cl-7a91c12a"><span class="cl-7a90826a">long</span></p></th>
<th class="cl-7a91ca31"><p class="cl-7a91c12a"><span class="cl-7a90826a">age</span></p></th>
<th class="cl-7a91ca32"><p class="cl-7a91c12a"><span class="cl-7a90826a">Tag_ID</span></p></th>
<th class="cl-7a91ca33"><p class="cl-7a91c12a"><span class="cl-7a90826a">Deploy_ID</span></p></th>
</tr></thead>
<tbody>
<tr style="overflow-wrap:break-word;">
<td class="cl-7a91ca34"><p class="cl-7a91c12a"><span class="cl-7a908274">GY02215</span></p></td>
<td class="cl-7a91ca3a"><p class="cl-7a91c12a"><span class="cl-7a908274">Argos PTT</span></p></td>
<td class="cl-7a91ca3b"><p class="cl-7a91c12a"><span class="cl-7a908274">10/02/2022</span></p></td>
<td class="cl-7a91ca3b"><p class="cl-7a91c12a"><span class="cl-7a908274">11:18:00</span></p></td>
<td class="cl-7a91ca3c"><p class="cl-7a91c12a"><span class="cl-7a908274">-7.250352</span></p></td>
<td class="cl-7a91ca3d"><p class="cl-7a91c12a"><span class="cl-7a908274">72.45164</span></p></td>
<td class="cl-7a91ca44"><p class="cl-7a91c12a"><span class="cl-7a908274">Immature Basic 2</span></p></td>
<td class="cl-7a91ca45"><p class="cl-7a91c12a"><span class="cl-7a908274">229276</span></p></td>
<td class="cl-7a91ca46"><p class="cl-7a91c12a"><span class="cl-7a908274">1</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-7a91ca47"><p class="cl-7a91c12a"><span class="cl-7a908274">GY02216</span></p></td>
<td class="cl-7a91ca4e"><p class="cl-7a91c12a"><span class="cl-7a908274">Argos PTT</span></p></td>
<td class="cl-7a91ca4f"><p class="cl-7a91c12a"><span class="cl-7a908274">10/02/2022</span></p></td>
<td class="cl-7a91ca4f"><p class="cl-7a91c12a"><span class="cl-7a908274">12:07:00</span></p></td>
<td class="cl-7a91ca50"><p class="cl-7a91c12a"><span class="cl-7a908274">-7.247698</span></p></td>
<td class="cl-7a91ca51"><p class="cl-7a91c12a"><span class="cl-7a908274">72.45145</span></p></td>
<td class="cl-7a91ca58"><p class="cl-7a91c12a"><span class="cl-7a908274">Immature Basic 1</span></p></td>
<td class="cl-7a91ca59"><p class="cl-7a91c12a"><span class="cl-7a908274">229275</span></p></td>
<td class="cl-7a91ca5a"><p class="cl-7a91c12a"><span class="cl-7a908274">1</span></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="callout-warning callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
🧠 User input required
</div>
</div>
<div class="callout-body-container callout-body">
<p>First we define the path to our metadata file:</p>
<div class="cell">
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">filepath_meta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"Data"</span>,<span class="st">"RFB_IMM_Metadata.csv"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then much like in Step 1, we define the date format(s) used (for passing to <a href="https://lubridate.tidyverse.org/reference/lubridate-package.html"><code>lubridate</code></a>) (<code>d</code> = day as decimal, <code>m</code> = month as decimal, <code>y</code> = year without century - 2 digits, <code>Y</code> = year with century - 4 digits). Here, we’ve included common combinations, which you’ll need to modify if your metadata include a different format (run <code><a href="https://rdrr.io/r/base/timezones.html">OlsonNames()</a></code> to return a full list of time zones names).</p>
<div class="cell">
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">metadate_formats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"dmY"</span>, <span class="st">"Ymd"</span><span class="op">)</span> <span class="co">#specify date format used in metadata</span></span>
<span><span class="va">metadatetime_formats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"dmY HMS"</span>, <span class="st">"Ymd HMS"</span><span class="op">)</span> <span class="co">#specify date &amp; time format</span></span>
<span><span class="va">metadatatimezone</span> <span class="op">&lt;-</span> <span class="st">"Indian/Chagos"</span> <span class="co">#specify timezone used for metadata</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next we read in the metadata file (make sure to check the <code>read_</code> function you’re using matches your ddata format!).</p>
<div class="cell">
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df_metadata</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="va">filepath_meta</span><span class="op">)</span> <span class="co"># Read in metadata file</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">df_metadata</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then we select necessary comments &amp; coerce column names, making sure to provide four compulsory columns: <strong>ID</strong> — as defined in tracking data (individual <strong>ID</strong> or <strong>TagID</strong>), <strong>deployment date</strong> &amp; <strong>deployment time</strong>. We can also provide optional columns depending on sensor type: e.g.&nbsp;colony, sex, age, central place (CP) Lat, CP Lon. Depending on whether you know the CP for each individual, you can use one of the two following approaches, and delete columns where appropriate.  <strong>NB:</strong> Different tags types sometimes require specific approaches for dealing with data collected outside of deployment period (e.g., before deployment or after retrieval). If data need to be filtered for one or both of these scenarios, we need to sort out these columns in the metadata, and if not relevant for the data, set column name to “NA”.</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true" href="">Select metadata columns</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false" href="">Option: Individual CP unknown</a></li>
</ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<p>If you have multiple ID columns like TagID/DeployID, include them here (for example, if one individual was tracked over multiple deployments/years, or if one tag was re-deployed on multiple individuals). For more information and helpful code, see the <a href="FAQ's.html">FAQ document</a> and <a href="https://github.com/ExMove/ExMove/blob/main/R/Troubleshoot_Multiple%20ID%20columns.R">troubleshooting script</a>.</p>
<div class="cell">
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df_metadataslim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>ID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">df_metadata</span><span class="op">$</span><span class="va">bird_id</span><span class="op">)</span>, <span class="co"># compulsory column</span></span>
<span>                              TagID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">df_metadata</span><span class="op">$</span><span class="va">Tag_ID</span><span class="op">)</span>,</span>
<span>                              DeployID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">df_metadata</span><span class="op">$</span><span class="va">Deploy_ID</span><span class="op">)</span>,</span>
<span>                              DeployDate_local <span class="op">=</span> <span class="va">df_metadata</span><span class="op">$</span><span class="va">capture_date</span>, <span class="co"># compulsory column (set to NA if not relevant)</span></span>
<span>                              DeployTime_local <span class="op">=</span> <span class="va">df_metadata</span><span class="op">$</span><span class="va">capture_time</span>, <span class="co"># compulsory column (set to NA if not relevant)</span></span>
<span>                              RetrieveDate_local <span class="op">=</span> <span class="cn">NA</span>, <span class="co"># compulsory column (set to NA if not relevant)</span></span>
<span>                              RetrieveTime_local <span class="op">=</span> <span class="cn">NA</span>, <span class="co"># compulsory column (set to NA if not relevant)</span></span>
<span>                              DeployLat <span class="op">=</span> <span class="va">df_metadata</span><span class="op">$</span><span class="va">lat</span>,</span>
<span>                              DeployLon <span class="op">=</span> <span class="va">df_metadata</span><span class="op">$</span><span class="va">long</span>,</span>
<span>                              Species <span class="op">=</span> <span class="st">"RFB"</span>,</span>
<span>                              Age <span class="op">=</span> <span class="va">df_metadata</span><span class="op">$</span><span class="va">age</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<p>If central place for each individual is not known, you can add population-level central places here by first creating a custom dataframe of population CPs:</p>
<div class="cell">
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## ** Option ** ##</span></span>
<span><span class="va">df_PopCPs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">Population</span>,  <span class="op">~</span><span class="va">CPLat</span>,    <span class="op">~</span><span class="va">CPLon</span>,</span>
<span>  <span class="st">"DG"</span>,         <span class="op">-</span><span class="fl">7.24</span>,     <span class="fl">72.43</span>,</span>
<span>  <span class="st">"NI"</span>,         <span class="op">-</span><span class="fl">5.68</span>,     <span class="fl">71.24</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then we can merge <code>df_metadataslim</code> and <code>df_PopCPs.</code> The <code>Population</code> column must be present in both dataframes (this codes uses the <code>%&lt;&gt;%</code> pipe, so will overwrite <code>CPLat</code> and <code>CPLon</code> if these are present in <code>df_metadataslim</code>).</p>
<div class="cell">
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df_metadataslim</span>  <span class="op">%&lt;&gt;%</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">matches</a></span><span class="op">(</span><span class="fu"><a href="https://generics.r-lib.org/reference/setops.html">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">df_metadataslim</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"CPLat"</span>, <span class="st">"CPLon"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">df_PopCPs</span>, by <span class="op">=</span> <span class="st">"Population"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<p>Format all dates and times, combine them and specify timezone (NA’s in deployment/retrieval date times will throw warnings, but these are safe to ignore if you know there are NA’s in these columns).</p>
<div class="cell">
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df_metadataslim</span> <span class="op">&lt;-</span> <span class="va">df_metadataslim</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Deploydatetime <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/parse_date_time.html">parse_date_time</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">DeployDate_local</span>, <span class="va">DeployTime_local</span><span class="op">)</span>,<span class="co">#create deploy datetime</span></span>
<span>                                          order<span class="op">=</span><span class="va">metadatetime_formats</span>, </span>
<span>                                          tz<span class="op">=</span><span class="va">metadatatimezone</span><span class="op">)</span>,</span>
<span>         Retrievedatetime <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/parse_date_time.html">parse_date_time</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">RetrieveDate_local</span>, <span class="va">RetrieveTime_local</span><span class="op">)</span>, <span class="co">#create retrieve datetime</span></span>
<span>                                            order<span class="op">=</span><span class="va">metadatetime_formats</span>,</span>
<span>                                            tz<span class="op">=</span><span class="va">metadatatimezone</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">any_of</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"DeployDate_local"</span>,<span class="st">"DeployTime_local"</span>, <span class="st">"RetrieveDate_local"</span>, <span class="st">"RetrieveTime_local"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">'datetime'</span><span class="op">)</span>, <span class="co">#return datetime as it would appear in a different tz</span></span>
<span>                <span class="op">~</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/with_tz.html">with_tz</a></span><span class="op">(</span><span class="va">.</span>, tzone<span class="op">=</span><span class="va">trackingdatatimezone</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There was 1 warning in `mutate()`.
ℹ In argument: `Retrievedatetime = parse_date_time(...)`.
Caused by warning:
! All formats failed to parse. No formats found.</code></pre>
</div>
</div>
<p>Here we’ll create a dataframe of temporal extents of our data to use in absence of deploy/retrieve times (this is also useful for basic data checks and for writing up methods).</p>
<div class="cell">
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df_temporalextents</span> <span class="op">&lt;-</span> <span class="va">df_raw</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">all_of</a></span><span class="op">(</span><span class="va">ID_type</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>min_datetime <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">DateTime</span><span class="op">)</span>,</span>
<span>            max_datetime <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">DateTime</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then we use these temporal extents of our data to fill in any NA’s in the deploy/retrieve times.</p>
<div class="cell">
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df_metadataslim</span> <span class="op">&lt;-</span> <span class="va">df_metadataslim</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">df_temporalextents</span>, by <span class="op">=</span> <span class="va">ID_type</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Deploydatetime <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">Deploydatetime</span><span class="op">)</span> <span class="op">~</span> <span class="va">Deploydatetime</span>,</span>
<span>                                      <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">Deploydatetime</span><span class="op">)</span> <span class="op">~</span> <span class="va">min_datetime</span><span class="op">)</span>,</span>
<span>         Retrievedatetime <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">Retrievedatetime</span><span class="op">)</span> <span class="op">~</span> <span class="va">Retrievedatetime</span>,</span>
<span>                                      <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">Retrievedatetime</span><span class="op">)</span> <span class="op">~</span> <span class="va">max_datetime</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">min_datetime</span>, <span class="va">max_datetime</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next we merge metadata with raw data using the ID column.</p>
<div class="cell">
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df_metamerged</span> <span class="op">&lt;-</span> <span class="va">df_raw</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">df_metadataslim</span>, by<span class="op">=</span><span class="va">ID_type</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, we can remove intermediate files/objects by specifying objects to keep.</p>
<div class="cell">
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"df_metamerged"</span>, <span class="st">"species_code"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="co">#specify objects to keep</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="cleaning" class="level2"><h2 class="anchored" data-anchor-id="cleaning">3. Cleaning</h2>
<div class="callout-warning callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
🧠 User input required
</div>
</div>
<div class="callout-body-container callout-body">
<p>Define your own no/empty/erroneous data values in <code>Lat</code> and <code>Lon</code> columns (e.g.&nbsp;“bad” values specified by the tag manufacturer).</p>
<div class="cell">
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">No_data_vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="op">-</span><span class="fl">999</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Define a vector of columns which can’t have NAs (if there are NAs in one of these columns the problematic row will be removed).</p>
<div class="cell">
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">na_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Lat"</span>, <span class="st">"Lon"</span>, <span class="st">"DateTime"</span>, <span class="st">"ID"</span><span class="op">)</span> <span class="co">#column to check for na's</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>Now we pipe the data through a series of functions to drop NAs in specified columns, filter out user-defined <code>no_data_values</code> in <code>Lat</code> <code>Lon</code> columns, remove duplicates, remove undeployed locations and filter out locations within temporal cut-off following deployment.</p>
<div class="cell">
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df_clean</span> <span class="op">&lt;-</span> <span class="va">df_metamerged</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">all_of</a></span><span class="op">(</span><span class="va">na_cols</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">Lat</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">No_data_vals</span> <span class="op">&amp;</span> <span class="op">!</span><span class="va">Lon</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">No_data_vals</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># remove bad data values in Lat Lon columns</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="va">DateTime</span>, <span class="va">ID</span>, .keep_all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># this might be a problem for ACC data missing milliseconds, so beware if using it for this purpose!</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">Retrievedatetime</span><span class="op">)</span> <span class="op">~</span> <span class="va">Deploydatetime</span> <span class="op">&lt;</span> <span class="va">DateTime</span> <span class="op">&amp;</span> <span class="va">DateTime</span> <span class="op">&lt;</span> <span class="va">Retrievedatetime</span>, <span class="co"># keep deployment period, only</span></span>
<span>                   .default <span class="op">=</span> <span class="va">Deploydatetime</span> <span class="op">&lt;</span> <span class="va">DateTime</span><span class="op">)</span><span class="op">)</span> <span class="co"># if retrieve date is NA (i.e., tags submit via satellite), only filter by deploy date</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">df_clean</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   TagID            DateTime lc    Lat    Lon   Lat2   Lon2       Date Year
1 229275 2022-02-10 12:59:50  A -7.255 72.470 -7.255 72.470 2022-02-10 2022
2 229275 2022-02-10 14:42:30  B -7.261 72.476 -7.261 72.476 2022-02-10 2022
3 229275 2022-02-10 15:00:42  3 -7.249 72.448 -7.249 72.448 2022-02-10 2022
4 229275 2022-02-10 15:15:24  3 -7.250 72.452 -7.250 72.452 2022-02-10 2022
5 229275 2022-02-10 16:03:10  B -7.252 72.458 -7.252 72.458 2022-02-10 2022
6 229275 2022-02-10 16:51:55  B -7.250 72.458 -7.250 72.458 2022-02-10 2022
       ID DeployID DeployLat DeployLon Species              Age
1 GY02216        1 -7.247698  72.45145     RFB Immature Basic 1
2 GY02216        1 -7.247698  72.45145     RFB Immature Basic 1
3 GY02216        1 -7.247698  72.45145     RFB Immature Basic 1
4 GY02216        1 -7.247698  72.45145     RFB Immature Basic 1
5 GY02216        1 -7.247698  72.45145     RFB Immature Basic 1
6 GY02216        1 -7.247698  72.45145     RFB Immature Basic 1
       Deploydatetime    Retrievedatetime
1 2022-02-10 06:07:00 2022-02-23 14:51:37
2 2022-02-10 06:07:00 2022-02-23 14:51:37
3 2022-02-10 06:07:00 2022-02-23 14:51:37
4 2022-02-10 06:07:00 2022-02-23 14:51:37
5 2022-02-10 06:07:00 2022-02-23 14:51:37
6 2022-02-10 06:07:00 2022-02-23 14:51:37</code></pre>
</div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Option: Filter by fix quality
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Argos fix quality can be used to filter the data set to remove locations with too much uncertainty. If you know the error classes that you want to retain in this dataset, you can run this filter below.  <strong>NB:</strong> If you want to do further exploration of location quality (e.g., from GPS PTT tags to compare locations with contemporaneous GPS locations), keep all location classes by skipping this step.</p>
<p>In this code we define a vector of location classes to keep (typically, location classes 1, 2, and 3 are of sufficient certainty), and filter out everything else.</p>
<div class="cell">
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lc_keep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"3"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_clean</span> <span class="op">&lt;-</span> <span class="va">df_clean</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">lc</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">lc_keep</span><span class="op">)</span> <span class="co"># filter data to only retain location classes in lc_keep</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">df_clean</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   TagID            DateTime lc    Lat    Lon   Lat2   Lon2       Date Year
1 229275 2022-02-10 15:00:42  3 -7.249 72.448 -7.249 72.448 2022-02-10 2022
2 229275 2022-02-10 15:15:24  3 -7.250 72.452 -7.250 72.452 2022-02-10 2022
3 229275 2022-02-10 17:00:47  3 -7.251 72.449 -7.251 72.449 2022-02-10 2022
4 229275 2022-02-11 13:24:11  3 -7.638 74.659 -7.638 74.659 2022-02-11 2022
5 229275 2022-02-11 14:06:46  1 -7.653 74.630 -7.653 74.630 2022-02-11 2022
6 229275 2022-02-11 14:52:05  1 -7.677 74.638 -7.677 74.638 2022-02-11 2022
       ID DeployID DeployLat DeployLon Species              Age
1 GY02216        1 -7.247698  72.45145     RFB Immature Basic 1
2 GY02216        1 -7.247698  72.45145     RFB Immature Basic 1
3 GY02216        1 -7.247698  72.45145     RFB Immature Basic 1
4 GY02216        1 -7.247698  72.45145     RFB Immature Basic 1
5 GY02216        1 -7.247698  72.45145     RFB Immature Basic 1
6 GY02216        1 -7.247698  72.45145     RFB Immature Basic 1
       Deploydatetime    Retrievedatetime
1 2022-02-10 06:07:00 2022-02-23 14:51:37
2 2022-02-10 06:07:00 2022-02-23 14:51:37
3 2022-02-10 06:07:00 2022-02-23 14:51:37
4 2022-02-10 06:07:00 2022-02-23 14:51:37
5 2022-02-10 06:07:00 2022-02-23 14:51:37
6 2022-02-10 06:07:00 2022-02-23 14:51:37</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Finally we remove intermediate files/objects</p>
<div class="cell">
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"df_clean"</span>, <span class="st">"species_code"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="co">#specify objects to keep</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="processing" class="level2"><h2 class="anchored" data-anchor-id="processing">4. Processing</h2>
<section id="some-useful-temporal-and-spatial-calculations-on-the-data" class="level4"><h4 class="anchored" data-anchor-id="some-useful-temporal-and-spatial-calculations-on-the-data">Some useful temporal and spatial calculations on the data</h4>
<div class="callout-warning callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
🧠 User input required
</div>
</div>
<div class="callout-body-container callout-body">
<p>First we need to specify the co-ordinate projection systems for the tracking data and meta data. The default here is lon/lat for both tracking data &amp; metadata, for which the EPSG code is 4326. For more information see the <a href="FAQ's.html#what-is-a-crs">CRS section of the FAQ’s</a> or have a look at the <a href="https://epsg.io/">ESPG.io database</a>.</p>
<div class="cell">
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tracking_crs</span> <span class="op">&lt;-</span> <span class="fl">4326</span> <span class="co"># Only change if data are in a different coordinate system</span></span>
<span><span class="va">meta_crs</span> <span class="op">&lt;-</span> <span class="fl">4326</span> <span class="co"># Only change if data are in a different coordinate system</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>Next we transform coordinates of data, and perform spatial calculations. This requires spatial analysis, and so it is good practice to run all spatial analyses in a coordinate reference system that uses metres as a unit.</p>
<p>As an example, we will use Spherical Mercator projection — <em>aka</em> “WGS” (crs = 3857). It’s important to consider the location and scale of your data (e.g., equatorial/polar/local scale/global scale) when choosing a projection system. Other options include (but are not limited to) UTM, and Lambert azimuthal equal-area (LAEA).</p>
<p>Here we’ll calculate bearings relative to first location.</p>
<div class="cell">
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df_diagnostic</span> <span class="op">&lt;-</span>  <span class="va">df_clean</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co">#need to ungroup to extract geometry of the whole dataset</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>geometry_GPS <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span> <span class="co"># assign geometry and transform to WGS for distance calculations</span></span>
<span>      <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="va">.</span>, coords<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Lon"</span>,<span class="st">"Lat"</span><span class="op">)</span>, crs<span class="op">=</span><span class="va">tracking_crs</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">3857</span><span class="op">)</span><span class="op">$</span><span class="va">geometry</span>,</span>
<span>    geometry_first <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="va">.</span>, <span class="fl">1</span><span class="op">)</span>, coords<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Lon"</span>,<span class="st">"Lat"</span><span class="op">)</span>, crs<span class="op">=</span><span class="va">tracking_crs</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">3857</span><span class="op">)</span><span class="op">$</span><span class="va">geometry</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">ID</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co">#back to grouping by ID for calculations per individual</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>dist <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html">st_distance</a></span><span class="op">(</span><span class="va">geometry_GPS</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html">lag</a></span><span class="op">(</span><span class="va">geometry_GPS</span><span class="op">)</span>, by_element <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, <span class="co"># distance travelled from previous fix</span></span>
<span>         difftime <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/difftime.html">difftime</a></span><span class="op">(</span><span class="va">DateTime</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html">lag</a></span><span class="op">(</span><span class="va">DateTime</span><span class="op">)</span>, units<span class="op">=</span><span class="st">"secs"</span><span class="op">)</span>,          <span class="co"># time passed since previous fix</span></span>
<span>         netdisp <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html">st_distance</a></span><span class="op">(</span><span class="va">geometry_GPS</span>, <span class="va">geometry_first</span>, by_element <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, <span class="co"># calculate distance between first location and current location</span></span>
<span>         speed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">dist</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">difftime</span><span class="op">)</span>,                       <span class="co"># calculate speed (distance/time)</span></span>
<span>         dLon <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">Lon</span><span class="op">)</span><span class="op">-</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html">lag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">Lon</span><span class="op">)</span><span class="op">)</span>, <span class="co">#difference in longitude, relative to previous location</span></span>
<span>         dLat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">Lat</span><span class="op">)</span><span class="op">-</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html">lag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">Lat</span><span class="op">)</span><span class="op">)</span>, <span class="co">#difference in longitude, relative to previous location</span></span>
<span>         turnangle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">atan2</a></span><span class="op">(</span><span class="va">dLon</span>, <span class="va">dLat</span><span class="op">)</span><span class="op">*</span><span class="fl">180</span><span class="op">/</span><span class="va">pi</span> <span class="op">+</span> <span class="op">(</span><span class="va">dLon</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">*</span><span class="fl">360</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co">#angle (in degrees) from previous to current location using formula theta = atan(y/x), where y = change along y axis &amp; x = change along x axis</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">geometry_GPS</span>, <span class="va">dLon</span>, <span class="va">dLat</span><span class="op">)</span><span class="op">)</span> <span class="co"># ungroup and remove geometries</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Option: CP data included
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>If your data include a Central Place location, you can also run the following code to calculate bearings relative to CP</p>
<div class="cell">
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## ** Option ** ##</span></span>
<span><span class="va">df_diagnostic</span> <span class="op">&lt;-</span>  <span class="va">df_diagnostic</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co">#need to ungroup to extract geometry of the whole dataset</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>geometry_GPS <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span> <span class="co">#assign geometry and transform to WGS for dist calcs</span></span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="va">.</span>, coords<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Lon"</span>,<span class="st">"Lat"</span><span class="op">)</span>, crs<span class="op">=</span><span class="va">tracking_crs</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">3857</span><span class="op">)</span><span class="op">$</span><span class="va">geometry</span>,</span>
<span>    geometry_CP <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span> <span class="co">#assign geometry and transform to WGS for dist calcs</span></span>
<span>      <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="va">.</span>, coords<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"CPLon"</span>,<span class="st">"CPLat"</span><span class="op">)</span>, crs<span class="op">=</span><span class="va">meta_crs</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">3857</span><span class="op">)</span><span class="op">$</span><span class="va">geometry</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">ID</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co">#back to grouping by ID for calculations per individual</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>CPdist <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html">st_distance</a></span><span class="op">(</span><span class="va">geometry_GPS</span>, <span class="va">geometry_CP</span>, by_element <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, <span class="co">#calculate distance between central place and current location</span></span>
<span>         dLon_CP <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">Lon</span><span class="op">)</span><span class="op">-</span><span class="va">CPLon</span>, <span class="co">#difference in longitude between current location and central place</span></span>
<span>         dLat_CP <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">Lat</span><span class="op">)</span><span class="op">-</span><span class="va">CPLat</span>, <span class="co">#difference in longitude between current location and central place</span></span>
<span>         CPbearing <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">atan2</a></span><span class="op">(</span><span class="va">dLon_CP</span>, <span class="va">dLat_CP</span><span class="op">)</span><span class="op">*</span><span class="fl">180</span><span class="op">/</span><span class="va">pi</span> <span class="op">+</span> <span class="op">(</span><span class="va">dLon_CP</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">*</span><span class="fl">360</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co">#bearing (in degrees) from central place to current location using formula theta = atan(y/x), where y = change along y axis from CP &amp; x = change along x axis from CP</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">geometry_GPS</span>, <span class="va">geometry_CP</span>, <span class="va">dLon</span>, <span class="va">dLat</span>, <span class="va">dLon_CP</span>, <span class="va">dLat_CP</span><span class="op">)</span><span class="op">)</span> <span class="co">#ungroup and remove geometries</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section></section><section id="save-for-shiny" class="level2"><h2 class="anchored" data-anchor-id="save-for-shiny">5. Save for Shiny</h2>
<p>Here we’re going to save <code>df_diagnostic</code> to use in the Shiny app provided. The app is designed to explore how further filtering and processing steps affect the data.</p>
<div class="callout-warning callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
🧠 User input required
</div>
</div>
<div class="callout-body-container callout-body">
<p>First, we use <a href="https://here.r-lib.org/">here</a> to create a file path for saving the working dataframe files, and create the folder if missing</p>
<div class="cell">
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">filepath_dfout</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"DataOutputs"</span>,<span class="st">"WorkingDataFrames"</span><span class="op">)</span> <span class="co"># create filepath</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="va">filepath_dfout</span><span class="op">)</span> <span class="co"># create folder if it doesn't exist</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next we define file name for the saved file by pasting the species code before <code>_diagnostic</code> (can change this if you want to use a different naming system).</p>
<div class="cell">
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">filename_dfout</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">species_code</span>, <span class="st">"_diagnostic"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If not added from the metadata, add a species column and any other columns here relevant to your data <em>(optional)</em></p>
<div class="cell">
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## ** Option ** ##</span></span>
<span><span class="va">df_diagnostic</span><span class="op">$</span><span class="va">Species</span> <span class="op">&lt;-</span> <span class="va">species_code</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>Finally we save the <code>df_diagnostic</code> as a csv file using the variables created above.</p>
<div class="cell">
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span><span class="op">(</span><span class="va">df_diagnostic</span>, file <span class="op">=</span> <span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="va">filepath_dfout</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">filename_dfout</span>,<span class="st">".csv"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Remove everything except <code>df_diagnostic</code> ahead of the next step.</p>
<div class="cell">
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"df_diagnostic"</span>, <span class="st">"species_code"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="co">#specify objects to keep</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="filtering" class="level2"><h2 class="anchored" data-anchor-id="filtering">6. Filtering</h2>
<p>This second filtering stage is designed to remove outliers in the data, and you can use outputs from the Shiny app to inform these choices. If you don’t need to filter for outliers, skip this step and keep using <code>df_diagnostic</code> in the next steps.</p>
<section id="shiny-app" class="level3"><h3 class="anchored" data-anchor-id="shiny-app">Accessing the Shiny app</h3>
<section id="option-1" class="level4"><h4 class="anchored" data-anchor-id="option-1">Option 1:</h4>
<p>Access the Shiny app online at the following link: <a href="https://lukeozsanlav.shinyapps.io/exmove_explorer/">https://lukeozsanlav.shinyapps.io/exmove_explorer/</a></p>
</section><section id="option-2" class="level4"><h4 class="anchored" data-anchor-id="option-2">Option 2:</h4>
<p>Alternatively run the app from your local R session with the following code</p>
<div class="cell">
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="st"><a href="https://shiny.rstudio.com/">"shiny"</a></span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"shiny"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.rstudio.com/">shiny</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/runUrl.html">runGitHub</a></span><span class="op">(</span><span class="st">"ExMoveApp"</span>, username <span class="op">=</span> <span class="st">"LukeOzsanlav"</span>,</span>
<span>          ref <span class="op">=</span> <span class="st">"master"</span>, subdir <span class="op">=</span> <span class="st">"app"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="app-usage" class="level4"><h4 class="anchored" data-anchor-id="app-usage">App usage:</h4>
<ul>
<li>Upload your csv version of <code>df_diagnostic</code> to the app by clicking the <code>Upload data</code> button in the top left.</li>
<li>At the bottom of each app page are printed code chunks that can be copied into subsequent user input section. These code chunks contain the user input values you manually select in the app</li>
</ul></section><section id="define-threshold-values" class="level4"><h4 class="anchored" data-anchor-id="define-threshold-values">Define threshold values</h4>
<div class="callout-warning callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
🧠 User input required
</div>
</div>
<div class="callout-body-container callout-body">
<p>First we define a period to filter after tag deployment, when all points before the cutoff will be removed (e.g.&nbsp;to remove potentially unnatural behaviour following the tagging event). We define this period using the <code>as.period</code> function, by providing an integer value and time unit (e.g.&nbsp;hours/days/years). This code below specifies a period of 30 minutes:</p>
<div class="cell">
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">filter_cutoff</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/as.period.html">as.period</a></span><span class="op">(</span><span class="fl">30</span>, unit<span class="op">=</span><span class="st">"minutes"</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then we define speed threshold in m/s, which we will use to remove any points with faster speeds.</p>
<div class="cell">
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">filter_speed</span> <span class="op">&lt;-</span> <span class="fl">20</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next we define a net displacement (distance from first point) threshold and specify units. Any points further away from the first tracking point will be removed (see commented code for how to retain all points):</p>
<div class="cell">
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">filter_netdisp_dist</span> <span class="op">&lt;-</span> <span class="fl">200</span></span>
<span><span class="va">filter_netdist_units</span> <span class="op">&lt;-</span> <span class="st">"km"</span> <span class="co"># e.g., "m", "km"</span></span>
<span></span>
<span><span class="co">#If you want to retain points no matter the net displacement value, use these values instead:</span></span>
<span><span class="co">#filter_netdisp_dist &lt;- max(df_diagnostic$netdisp)</span></span>
<span><span class="co">#filter_netdist_units &lt;- "m"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<section id="implement-filters" class="level5"><h5 class="anchored" data-anchor-id="implement-filters">Implement filters</h5>
<p>Create net displacement filter using distance and units</p>
<div class="cell">
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">filter_netdisp</span> <span class="op">&lt;-</span> <span class="fu">units</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/units/man/units.html">as_units</a></span><span class="op">(</span><span class="va">filter_netdisp_dist</span>, <span class="va">filter_netdist_units</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Filter df_diagnostic</p>
<div class="cell">
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df_filtered</span> <span class="op">&lt;-</span> <span class="va">df_diagnostic</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Deploydatetime</span> <span class="op">+</span> <span class="va">filter_cutoff</span> <span class="op">&lt;</span> <span class="va">DateTime</span>, <span class="co"># keep times after cutoff</span></span>
<span>         <span class="va">speed</span> <span class="op">&lt;</span> <span class="va">filter_speed</span>, <span class="co"># keep speeds slower than speed filter</span></span>
<span>         <span class="va">netdisp</span> <span class="op">&lt;=</span> <span class="va">filter_netdisp</span><span class="op">)</span> <span class="co"># keep distances less than net displacement filter</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">df_filtered</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 23
  TagID DateTime            lc    Lat   Lon   Lat2  Lon2  Date        Year ID   
  &lt;chr&gt; &lt;dttm&gt;              &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;date&gt;     &lt;dbl&gt; &lt;chr&gt;
1 2292… 2022-02-10 15:15:24 3     -7.2… 72.4… -7.2… 72.4… 2022-02-10  2022 GY02…
2 2292… 2022-02-10 17:00:47 3     -7.2… 72.4… -7.2… 72.4… 2022-02-10  2022 GY02…
3 2292… 2022-02-13 00:34:48 1     -7.0… 73.1… -3.1… 90.6… 2022-02-13  2022 GY02…
4 2292… 2022-02-13 01:52:12 2     -7.0… 73.0… -7.0… 73.0… 2022-02-13  2022 GY02…
5 2292… 2022-02-13 02:07:17 1     -7.0… 72.9… -7.0… 72.9… 2022-02-13  2022 GY02…
6 2292… 2022-02-13 03:12:58 1     -7.2… 72.8… -7.2… 72.8… 2022-02-13  2022 GY02…
# … with 13 more variables: DeployID &lt;chr&gt;, DeployLat &lt;dbl&gt;, DeployLon &lt;dbl&gt;,
#   Species &lt;chr&gt;, Age &lt;chr&gt;, Deploydatetime &lt;dttm&gt;, Retrievedatetime &lt;dttm&gt;,
#   geometry_first &lt;POINT [m]&gt;, dist [m], difftime &lt;drtn&gt;, netdisp [m],
#   speed &lt;dbl&gt;, turnangle &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Remove intermediate files/objects</p>
<div class="cell">
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"df_filtered"</span>, <span class="st">"species_code"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="co">#specify objects to keep</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section></section></section><section id="summarise-data" class="level2"><h2 class="anchored" data-anchor-id="summarise-data">7. Summarise cleaned &amp; filtered tracking data</h2>
<div class="callout-warning callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
🧠 User input required
</div>
</div>
<div class="callout-body-container callout-body">
<p>Set the units to display sampling rate in the summary table</p>
<div class="cell">
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sampleRateUnits</span> <span class="op">&lt;-</span> <span class="st">"mins"</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="define-levels-of-grouping-factors-to-summarise-over" class="level5"><h5 class="anchored" data-anchor-id="define-levels-of-grouping-factors-to-summarise-over">Define levels of grouping factors to summarise over</h5>
<p>Firstly, down to population level. Here, we are working on data from one population &amp; year, and so use <code>Species</code> as the grouping factor. Add any other relevant grouping factors here (e.g.&nbsp;Country / Year / Season / Age).</p>
<div class="cell">
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">grouping_factors_poplevel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Species"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Secondly, down to individual level (add <code>DeployID</code> for example if relevant).</p>
<div class="cell">
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">grouping_factors_indlevel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ID"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</div>
</div>
<section id="create-summary-tables" class="level5"><h5 class="anchored" data-anchor-id="create-summary-tables">Create summary tables</h5>
<p>Create a small function to calculate standard error.</p>
<div class="cell">
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">se</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span><span class="op">(</span><span class="va">x</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Create a summary table of individual-level summary statistics:</p>
<div class="cell">
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df_summary_ind</span> <span class="op">&lt;-</span> <span class="va">df_filtered</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">all_of</a></span><span class="op">(</span><span class="va">grouping_factors_poplevel</span><span class="op">)</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">all_of</a></span><span class="op">(</span><span class="va">grouping_factors_indlevel</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>NoPoints <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">NROW</a></span><span class="op">(</span><span class="va">ID</span><span class="op">)</span>, <span class="co"># number of fixes</span></span>
<span>            NoUniqueDates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">Date</span><span class="op">)</span><span class="op">)</span>, <span class="co"># number of tracking dates</span></span>
<span>            FirstDate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">Date</span><span class="op">)</span><span class="op">)</span>, <span class="co"># first tracking date</span></span>
<span>            LastDate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">Date</span><span class="op">)</span><span class="op">)</span>, <span class="co"># last tracking date</span></span>
<span>            SampleRate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">difftime</span>, units <span class="op">=</span> <span class="va">sampleRateUnits</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, <span class="co"># sample rate mean</span></span>
<span>            SampleRate_se <span class="op">=</span> <span class="fu">se</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">difftime</span>, units <span class="op">=</span> <span class="va">sampleRateUnits</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co"># sample rate standard error</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'Species'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df_summary_ind</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 8
# Groups:   Species [1]
  Species ID      NoPoints NoUniqueDates FirstDate  LastDate   SampleR…¹ Sampl…²
  &lt;chr&gt;   &lt;chr&gt;      &lt;int&gt;         &lt;int&gt; &lt;date&gt;     &lt;date&gt;         &lt;dbl&gt;   &lt;dbl&gt;
1 RFB     GY02215       53            11 2022-02-10 2022-02-26      285.    70.9
2 RFB     GY02216       34             8 2022-02-10 2022-02-20      291.    91.4
# … with abbreviated variable names ¹​SampleRate, ²​SampleRate_se</code></pre>
</div>
</div>
<p>Create a table of population-level summary statistics:</p>
<div class="cell">
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df_summary_pop</span> <span class="op">&lt;-</span> <span class="va">df_summary_ind</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># use the individual-level summary data</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="va">grouping_factors_poplevel</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>NoInds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">ID</span><span class="op">)</span><span class="op">)</span>, <span class="co"># number of unique individuals</span></span>
<span>            NoPoints_total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">NoPoints</span><span class="op">)</span>, <span class="co"># total number of tracking locations</span></span>
<span>            FirstDate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">FirstDate</span><span class="op">)</span><span class="op">)</span>, <span class="co"># first tracking date</span></span>
<span>            LastDate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">LastDate</span><span class="op">)</span><span class="op">)</span>, <span class="co"># last tracking date</span></span>
<span>            PointsPerBird <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">NoPoints</span><span class="op">)</span>, <span class="co"># number of locations per individual: mean</span></span>
<span>            PointsPerBird_se <span class="op">=</span> <span class="fu">se</span><span class="op">(</span><span class="va">NoPoints</span><span class="op">)</span>, <span class="co"># number of locations per individual: standard error</span></span>
<span>            DatesPerBird <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">NoUniqueDates</span><span class="op">)</span>, <span class="co"># number of tracking days per bird: mean</span></span>
<span>            DatesPerBird_se <span class="op">=</span> <span class="fu">se</span><span class="op">(</span><span class="va">NoUniqueDates</span><span class="op">)</span>, <span class="co"># number of tracking days per bird: standard error</span></span>
<span>            SampleRate_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">SampleRate</span><span class="op">)</span>, <span class="co"># sample rate mean</span></span>
<span>            SampleRate_se <span class="op">=</span> <span class="fu">se</span><span class="op">(</span><span class="va">SampleRate</span><span class="op">)</span><span class="op">)</span> <span class="co"># sample rate standard error</span></span>
<span><span class="va">df_summary_pop</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 11
  Species NoInds NoPoint…¹ FirstDate  LastDate   Point…² Point…³ Dates…⁴ Dates…⁵
  &lt;chr&gt;    &lt;int&gt;     &lt;int&gt; &lt;date&gt;     &lt;date&gt;       &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
1 RFB          2        87 2022-02-10 2022-02-26    43.5     9.5     9.5     1.5
# … with 2 more variables: SampleRate_mean &lt;dbl&gt;, SampleRate_se &lt;dbl&gt;, and
#   abbreviated variable names ¹​NoPoints_total, ²​PointsPerBird,
#   ³​PointsPerBird_se, ⁴​DatesPerBird, ⁵​DatesPerBird_se</code></pre>
</div>
</div>
<p>Remove intermediate files/objects by specifying which objects to keep:</p>
<div class="cell">
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"df_filtered"</span>, <span class="st">"df_summary_ind"</span>, <span class="st">"df_summary_pop"</span>, <span class="st">"species_code"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="co">#specify objects to keep</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="save-data" class="level2"><h2 class="anchored" data-anchor-id="save-data">8. Save filtered and summary data</h2>
<div class="callout-warning callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
🧠 User input required
</div>
</div>
<div class="callout-body-container callout-body">
<p>First we define the folder file path for saving our filtered data and create folder if not already present</p>
<div class="cell">
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">filepath_filtered_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"DataOutputs"</span>,<span class="st">"WorkingDataFrames"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="va">filepath_filtered_out</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then we define the file path for saving summary dataframes, again creating folder if needed</p>
<div class="cell">
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">filepath_summary_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"DataOutputs"</span>,<span class="st">"SummaryDataFrames"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="va">filepath_summary_out</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here we define file names for saved files, and paste the species code to <code>_summary_</code>, followed by <code>ind</code> (individual level) or <code>pop</code> (population level). You can change this if you want to use a different naming system.</p>
<div class="cell">
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">filename_filtered_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">species_code</span>, <span class="st">"_filtered"</span><span class="op">)</span></span>
<span><span class="va">filename_summary_ind_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">species_code</span>, <span class="st">"_summary_ind"</span><span class="op">)</span></span>
<span><span class="va">filename_summary_pop_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">species_code</span>, <span class="st">"_summary_pop"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>Now we can save all our dataframes as .csv files using our defined values</p>
<div class="cell">
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span><span class="op">(</span><span class="va">df_filtered</span>, file <span class="op">=</span> <span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="va">filepath_filtered_out</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">filename_filtered_out</span>,<span class="st">".csv"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span><span class="op">(</span><span class="va">df_summary_ind</span>, file <span class="op">=</span> <span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="va">filepath_summary_out</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">filename_summary_ind_out</span>,<span class="st">".csv"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span><span class="op">(</span><span class="va">df_summary_pop</span>, file <span class="op">=</span> <span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="va">filepath_summary_out</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">filename_summary_pop_out</span>,<span class="st">".csv"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Lastly we remove intermediate files/objects</p>
<div class="cell">
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"df_filtered"</span>, <span class="st">"df_summary_ind"</span>, <span class="st">"df_summary_pop"</span>, <span class="st">"species_code"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="co">#specify objects to keep</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="visualisation-i" class="level2"><h2 class="anchored" data-anchor-id="visualisation-i">9. Visualisation I</h2>
<div class="callout-warning callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
User input required
</div>
</div>
<div class="callout-body-container callout-body">
<p>Define parameters for reading out plots, and define device to read plots out as e.g.&nbsp;tiff/jpeg</p>
<div class="cell">
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">device</span> <span class="op">&lt;-</span> <span class="st">"tiff"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Define units for plot size (usually mm)</p>
<div class="cell">
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">units</span> <span class="op">&lt;-</span> <span class="st">"mm"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Define plot resolution in dpi (300 is usually good minimum)</p>
<div class="cell">
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dpi</span> <span class="op">&lt;-</span> <span class="fl">300</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Define filepath to read out plots and create folder if absent</p>
<div class="cell">
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">out_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"DataOutputs"</span>,<span class="st">"Figures"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="va">out_path</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We plot maps over a topography base-layer which can include terrestrial (elevation) and marine (bathymetry/water depth) data. To set legend label for topography data, relevant to your data.</p>
<div class="cell">
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">topo_label</span> <span class="op">=</span> <span class="st">"Depth (m)"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>Load additional libraries for spatial visualisation <strong>(optional)</strong></p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
If you see a <code>masking</code> warning these are fine. Watch out for packages that aren’t installed yet
</div>
</div>
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ropenscilabs/rnaturalearth">rnaturalearth</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ericpante/marmap">marmap</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://plotly-r.com">plotly</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>Create version of data for plotting by transforming required columns to numeric and creating time elapsed columns</p>
<div class="cell">
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df_plotting</span> <span class="op">&lt;-</span> <span class="va">df_filtered</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">ID</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>diffsecs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">difftime</span><span class="op">)</span>,</span>
<span>         secs_elapsed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/replace_na.html">replace_na</a></span><span class="op">(</span><span class="va">diffsecs</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         time_elapsed <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/as.duration.html">as.duration</a></span><span class="op">(</span><span class="va">secs_elapsed</span><span class="op">)</span>,</span>
<span>         days_elapsed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">time_elapsed</span>, <span class="st">"days"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">dist</span>,<span class="va">speed</span>, <span class="va">Lat</span>, <span class="va">Lon</span><span class="op">)</span>, <span class="va">as.numeric</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Create a map of all points. Set the plot limits as the max and min lat/longs as the tracking data</p>
<p>First set up a basemap to plot over: - Use rnatural earth low res countries basemap - co-ordinates in lat/long to match other spatial data</p>
<div class="cell">
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">countries</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rnaturalearth/man/ne_countries.html">ne_countries</a></span><span class="op">(</span>scale <span class="op">=</span> <span class="st">"medium"</span>, returnclass <span class="op">=</span> <span class="st">"sf"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Define min and max co-ordinates based on extent of tracking data, for adding bathymetry extracted from NOAA database.</p>
<div class="cell">
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">minlon</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">df_plotting</span><span class="op">$</span><span class="va">Lon</span><span class="op">)</span></span>
<span><span class="va">maxlon</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">df_plotting</span><span class="op">$</span><span class="va">Lon</span><span class="op">)</span></span>
<span></span>
<span><span class="va">minlat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">df_plotting</span><span class="op">$</span><span class="va">Lat</span><span class="op">)</span></span>
<span><span class="va">maxlat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">df_plotting</span><span class="op">$</span><span class="va">Lat</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Load in bathymetry basemap. Set limits slightly beyond tracking data to make a buffer so no gaps when plotting</p>
<div class="cell">
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">base_topography_map</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/marmap/man/getNOAA.bathy.html">getNOAA.bathy</a></span><span class="op">(</span></span>
<span>  lon1 <span class="op">=</span> <span class="va">minlon</span> <span class="op">-</span> <span class="fl">0.1</span>, lon2 <span class="op">=</span> <span class="va">maxlon</span> <span class="op">+</span> <span class="fl">0.1</span>,</span>
<span>  lat1 <span class="op">=</span> <span class="va">minlat</span> <span class="op">-</span> <span class="fl">0.1</span>, lat2 <span class="op">=</span> <span class="va">maxlat</span> <span class="op">+</span> <span class="fl">0.1</span>, </span>
<span>  resolution <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fortify bathymetry data for plotting</p>
<div class="cell">
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">base_topography_fort</span> <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/fortify.html">fortify</a></span><span class="op">(</span><span class="va">base_topography_map</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Create base map with correct extent, topography, country outlines, etc.,</p>
<div class="cell">
<div class="sourceCode" id="cb98"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">map_base</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_raster</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">base_topography_fort</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span>, fill<span class="op">=</span><span class="va">z</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># add colour scheme for the fill</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c</a></span><span class="op">(</span>option<span class="op">=</span><span class="st">"mako"</span>, name <span class="op">=</span> <span class="va">topo_label</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="co"># add map of countries over the top</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">countries</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>geometry <span class="op">=</span> <span class="va">geometry</span><span class="op">)</span>, fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="co"># set plot limits</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">coord_sf</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">minlon</span><span class="op">-</span><span class="fl">0.1</span>, <span class="va">maxlon</span><span class="op">+</span><span class="fl">0.1</span><span class="op">)</span>, </span>
<span>           ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">minlat</span><span class="op">-</span><span class="fl">0.1</span>, <span class="va">maxlat</span><span class="op">+</span><span class="fl">0.1</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span>, expand <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># add labels</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Longitude"</span>, y <span class="op">=</span> <span class="st">"Latitude"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>colour<span class="op">=</span><span class="st">"black"</span><span class="op">)</span>,</span>
<span>        axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>,</span>
<span>        axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust<span class="op">=</span><span class="fl">0.7</span><span class="op">)</span>,</span>
<span>        axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle<span class="op">=</span><span class="fl">90</span>, vjust <span class="op">=</span> <span class="fl">0.4</span>, size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>,</span>
<span>        axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust<span class="op">=</span><span class="fl">0.7</span>, angle<span class="op">=</span><span class="fl">90</span>, vjust<span class="op">=</span><span class="fl">0.3</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># set a theme</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_light</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">map_base</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="User_guide_files/figure-html/unnamed-chunk-82-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true" href="">Population</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false" href="">Several individuals</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-3" role="tab" aria-controls="tabset-4-3" aria-selected="false" href="">Option: Many individuals</a></li>
</ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<p>Plot a combined map of all tracking locations:</p>
<div class="cell">
<div class="sourceCode" id="cb99"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">map_alllocs</span> <span class="op">&lt;-</span> <span class="va">map_base</span> <span class="op">+</span> </span>
<span>  <span class="co"># add GPS points</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df_plotting</span>, </span>
<span>             <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Lon</span>, y <span class="op">=</span> <span class="va">Lat</span><span class="op">)</span>, </span>
<span>             alpha <span class="op">=</span> <span class="fl">0.8</span>, size <span class="op">=</span> <span class="fl">0.5</span>, col <span class="op">=</span> <span class="st">"violetred3"</span><span class="op">)</span> </span>
<span><span class="va">map_alllocs</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="User_guide_files/figure-html/unnamed-chunk-83-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<p>Plot a map of individual locations, colouring points by speed, and faceting by ID</p>
<div class="cell">
<div class="sourceCode" id="cb100"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">map_individuals</span> <span class="op">&lt;-</span> <span class="va">map_base</span> <span class="op">+</span> </span>
<span>  <span class="co"># add GPS points and paths between them</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df_plotting</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Lon</span>, y <span class="op">=</span> <span class="va">Lat</span>, col <span class="op">=</span> <span class="va">speed</span><span class="op">)</span>, </span>
<span>             alpha <span class="op">=</span> <span class="fl">0.8</span>, size <span class="op">=</span> <span class="fl">0.5</span> <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_path</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df_plotting</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Lon</span>, y <span class="op">=</span> <span class="va">Lat</span>, col <span class="op">=</span> <span class="va">speed</span><span class="op">)</span>, </span>
<span>            alpha <span class="op">=</span> <span class="fl">0.8</span>, size <span class="op">=</span> <span class="fl">0.5</span> <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># colour birds using scale_colour_gradient2</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_colour_gradient2</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Speed"</span>, low <span class="op">=</span> <span class="st">"blue"</span>, mid <span class="op">=</span> <span class="st">"white"</span>, high <span class="op">=</span> <span class="st">"red"</span>, </span>
<span>                         midpoint <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">df_plotting</span><span class="op">$</span><span class="va">speed</span>,na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="co"># `midpoint` argument ensures an even transition of color across speed value</span></span>
<span>  <span class="co"># facet for individual</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">ID</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html">n_distinct</a></span><span class="op">(</span><span class="va">df_plotting</span><span class="op">$</span><span class="va">ID</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="sourceCode" id="cb102"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">map_individuals</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="User_guide_files/figure-html/unnamed-chunk-84-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-4-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-3-tab">
<p>In previous plots, we’ve split the population into individual facets. This works fine on the example code, where we only have a few individuals, but if you have more individuals and the facets are too small, you can split the plot onto multiple pages. Use the below code to use <code>facet_wrap_paginate</code> from the <code>ggforce</code> package:</p>
<div class="cell" data-messages="false">
<div class="sourceCode" id="cb103"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## ** Option ** ##</span></span>
<span><span class="co">## save plot as object to later extract number of pages</span></span>
<span><span class="co">## e.g., with 2 per page:</span></span>
<span><span class="va">map_individuals</span> <span class="op">&lt;-</span> <span class="va">map_base</span> <span class="op">+</span> </span>
<span>  <span class="co"># add GPS points and paths between them</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df_plotting</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Lon</span>, y <span class="op">=</span> <span class="va">Lat</span>, col <span class="op">=</span> <span class="va">speed</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.8</span>, size <span class="op">=</span> <span class="fl">0.5</span> <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_path</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df_plotting</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Lon</span>, y <span class="op">=</span> <span class="va">Lat</span>, col <span class="op">=</span> <span class="va">speed</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.8</span>, size <span class="op">=</span> <span class="fl">0.5</span> <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># colour birds using scale_colour_gradient2</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_colour_gradient2</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Speed"</span>, low <span class="op">=</span> <span class="st">"blue"</span>, mid <span class="op">=</span> <span class="st">"white"</span>, high <span class="op">=</span> <span class="st">"red"</span>, midpoint <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">df_plotting</span><span class="op">$</span><span class="va">speed</span>,na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">##facet for individual</span></span>
<span>  <span class="fu">facet_wrap_paginate</span><span class="op">(</span><span class="op">~</span><span class="va">ID</span>, ncol <span class="op">=</span> <span class="fl">2</span>, nrow<span class="op">=</span> <span class="fl">1</span>, page <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>How many pages of plots?</p>
<div class="cell">
<div class="sourceCode" id="cb104"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">n_pages</span><span class="op">(</span><span class="va">map_individuals</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Run through different values of page to show each page in turn</p>
<div class="cell">
<div class="sourceCode" id="cb105"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">map_individuals</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>Save maps for further use using <code>ggsave</code> function.</p>
<div class="cell">
<div class="sourceCode" id="cb106"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span>plot <span class="op">=</span> <span class="va">map_alllocs</span>, </span>
<span>       filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">species_code</span>, <span class="st">"_map_all_locs.tiff"</span><span class="op">)</span>,</span>
<span>       device <span class="op">=</span> <span class="va">device</span>,</span>
<span>       path <span class="op">=</span> <span class="va">out_path</span>, </span>
<span>       units <span class="op">=</span> <span class="va">units</span>, width <span class="op">=</span> <span class="fl">200</span>, height <span class="op">=</span> <span class="fl">175</span>, dpi <span class="op">=</span> <span class="va">dpi</span>,   </span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span>plot <span class="op">=</span> <span class="va">map_individuals</span>, </span>
<span>       filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">species_code</span>, <span class="st">"_map_individuals.tiff"</span><span class="op">)</span>,</span>
<span>       device <span class="op">=</span> <span class="va">device</span>,</span>
<span>       path <span class="op">=</span> <span class="va">out_path</span>, </span>
<span>       units <span class="op">=</span> <span class="va">units</span>, width <span class="op">=</span> <span class="fl">200</span>, height <span class="op">=</span> <span class="fl">175</span>, dpi <span class="op">=</span> <span class="va">dpi</span>,   </span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Create a time series plot of speed, faceted for each individual.</p>
<div class="cell">
<div class="sourceCode" id="cb107"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">speed_time_plot</span> <span class="op">&lt;-</span> <span class="va">df_plotting</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co">#speed over time</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">.</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">days_elapsed</span>, y<span class="op">=</span><span class="va">speed</span>, group<span class="op">=</span><span class="va">ID</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># add line of speed over time</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="co"># add axis labels</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"time elapsed (days)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"speed (m/s)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># facet by individual</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">ID</span>, nrow<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html">n_distinct</a></span><span class="op">(</span><span class="va">df_plotting</span><span class="op">$</span><span class="va">ID</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># set plotting theme</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>colour<span class="op">=</span><span class="st">"black"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_light</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">speed_time_plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="User_guide_files/figure-html/unnamed-chunk-89-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Warnings about <code>non-finite</code> values for speed/step length plots are expected and usually refer to the first location for each individual (i.e.&nbsp;number of non-finite values should be equal to number of individuals)</p>
</div>
</div>
<p>Save plot for further use</p>
<div class="cell">
<div class="sourceCode" id="cb108"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span>plot <span class="op">=</span> <span class="va">speed_time_plot</span>, </span>
<span>       filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">species_code</span>, <span class="st">"_speed_timeseries_plot.tiff"</span><span class="op">)</span>,</span>
<span>       device <span class="op">=</span> <span class="va">device</span>,</span>
<span>       path <span class="op">=</span> <span class="va">out_path</span>, </span>
<span>       units <span class="op">=</span> <span class="va">units</span>, width <span class="op">=</span> <span class="fl">200</span>, height <span class="op">=</span> <span class="fl">175</span>, dpi <span class="op">=</span> <span class="va">dpi</span>  </span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Create a histogram of point to point speeds (can adjust binwidth and x limits manually)</p>
<div class="cell">
<div class="sourceCode" id="cb109"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">speed_hist</span> <span class="op">&lt;-</span> <span class="va">df_plotting</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">.</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">speed</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>binwidth<span class="op">=</span><span class="fl">0.1</span>, alpha<span class="op">=</span><span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span> <span class="co"># can adjust binwidth to suite your needs</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span><span class="fl">0.1</span><span class="op">*</span><span class="va">..count..</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># add plot labels</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"speed (m/s)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"count"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># facet by individual</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">ID</span>, nrow<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html">n_distinct</a></span><span class="op">(</span><span class="va">df_plotting</span><span class="op">$</span><span class="va">ID</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># set plotting theme</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>colour<span class="op">=</span><span class="st">"black"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_light</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">speed_hist</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The dot-dot notation (`..count..`) was deprecated in ggplot2 3.4.0.
ℹ Please use `after_stat(count)` instead.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="User_guide_files/figure-html/unnamed-chunk-91-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Save plot for further use</p>
<div class="cell">
<div class="sourceCode" id="cb111"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span>plot <span class="op">=</span> <span class="va">speed_hist</span>, </span>
<span>       filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">species_code</span>, <span class="st">"_speed_histogram.tiff"</span><span class="op">)</span>,</span>
<span>       device <span class="op">=</span> <span class="va">device</span>,</span>
<span>       path <span class="op">=</span> <span class="va">out_path</span>,</span>
<span>       units <span class="op">=</span> <span class="va">units</span>, width <span class="op">=</span> <span class="fl">200</span>, height <span class="op">=</span> <span class="fl">175</span>, dpi <span class="op">=</span> <span class="va">dpi</span>,   </span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Create a time series plot of step lengths (faceted for each individual)</p>
<div class="cell">
<div class="sourceCode" id="cb112"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">step_time_plot</span> <span class="op">&lt;-</span> <span class="va">df_plotting</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co">#step length over time</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">.</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">days_elapsed</span>, y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">netdisp</span><span class="op">)</span>, group<span class="op">=</span><span class="va">ID</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># add plot labels</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"time elapsed (days)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Distance from first fix (m)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># facet by individual</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">ID</span>, nrow<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html">n_distinct</a></span><span class="op">(</span><span class="va">df_plotting</span><span class="op">$</span><span class="va">ID</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># set plotting theme</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>colour<span class="op">=</span><span class="st">"black"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_light</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">step_time_plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="User_guide_files/figure-html/unnamed-chunk-93-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Save plot for further use</p>
<div class="cell">
<div class="sourceCode" id="cb113"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span>plot <span class="op">=</span> <span class="va">step_time_plot</span>, </span>
<span>       filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">species_code</span>, <span class="st">"_step_time_plot.tiff"</span><span class="op">)</span>,</span>
<span>       device <span class="op">=</span> <span class="va">device</span>,</span>
<span>       path <span class="op">=</span> <span class="va">out_path</span>,</span>
<span>       units <span class="op">=</span> <span class="va">units</span>, width <span class="op">=</span> <span class="fl">200</span>, height <span class="op">=</span> <span class="fl">175</span>, dpi <span class="op">=</span> <span class="va">dpi</span>,   </span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Create a histogram of step lengths (can adjust binwidth and x limits manually)</p>
<div class="cell">
<div class="sourceCode" id="cb114"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">step_hist</span> <span class="op">&lt;-</span> <span class="va">df_plotting</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co">#step histogram</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">.</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">dist</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>binwidth<span class="op">=</span><span class="fl">1</span>, alpha<span class="op">=</span><span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span> <span class="co"># can adjust binwidth to suite your needs</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span><span class="fl">1</span><span class="op">*</span><span class="va">..count..</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># add plot labels</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"step length (m)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"count"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># facet by individual</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">ID</span>, nrow<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html">n_distinct</a></span><span class="op">(</span><span class="va">df_plotting</span><span class="op">$</span><span class="va">ID</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="co"># set plotting theme</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_light</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Save plot for further use</p>
<div class="cell">
<div class="sourceCode" id="cb115"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span>plot <span class="op">=</span> <span class="va">step_hist</span>, </span>
<span>       filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">species_code</span>, <span class="st">"_step_hist.tiff"</span><span class="op">)</span>,</span>
<span>       device <span class="op">=</span> <span class="va">device</span>,</span>
<span>       path <span class="op">=</span> <span class="va">out_path</span>,</span>
<span>       units <span class="op">=</span> <span class="va">units</span>, width <span class="op">=</span> <span class="fl">200</span>, height <span class="op">=</span> <span class="fl">175</span>, dpi <span class="op">=</span> <span class="va">dpi</span>,   </span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Lastly, we remove intermediate files/objects if necessary to speed up any post-processing steps</p>
<div class="cell">
<div class="sourceCode" id="cb116"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"species_code"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="co">#specify objects to keep</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></main><!-- /main column --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
    var links = window.document.querySelectorAll('a:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
      }
    }
});
</script>
</div> <!-- /content -->



</body></html>